
<!doctype html>
<html lang="pt" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Oberlan Romão">
      
      
        <link rel="canonical" href="https://pc.oberlan.com/ed2/">
      
      <link rel="icon" href="../assets/logo.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.9">
    
    
      
        <title>Estrutura de Dados (Parte 2) - Programação Competitiva</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.120efc48.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.9647289d.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#estrutura-de-dados" class="md-skip">
          Pular para conteúdo
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabeçalho">
    <a href=".." title="Programação Competitiva" class="md-header__button md-logo" aria-label="Programação Competitiva" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Programação Competitiva
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Estrutura de Dados (Parte 2)
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Buscar" placeholder="Buscar" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Pesquisar">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Limpar" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando busca
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegação" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Programação Competitiva" class="md-nav__button md-logo" aria-label="Programação Competitiva" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Programação Competitiva
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Disciplina
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../inicio/" class="md-nav__link">
        Inicio
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../manipulacaobits/" class="md-nav__link">
        Manipulação de Bits
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../complexidade/" class="md-nav__link">
        Complexidade de Algoritmos
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../teorianumeros/" class="md-nav__link">
        Teoria dos Números
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../combinatoria/" class="md-nav__link">
        Combinatória
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../ordenacao/" class="md-nav__link">
        Ordenação e Busca
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../ed1/" class="md-nav__link">
        Estrutura de Dados (Parte 1)
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Estrutura de Dados (Parte 2)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Estrutura de Dados (Parte 2)
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Indice">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Indice
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#gnu-c-policy-based-sets" class="md-nav__link">
    GNU C++ Policy-Based Sets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fenwick-binary-indexed-tree" class="md-nav__link">
    Fenwick (Binary Indexed) Tree
  </a>
  
    <nav class="md-nav" aria-label="Fenwick (Binary Indexed) Tree">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementacao" class="md-nav__link">
    Implementação
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quando-usar" class="md-nav__link">
    Quando usar?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#material-complementar" class="md-nav__link">
    Material complementar
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#segment-tree" class="md-nav__link">
    Segment Tree
  </a>
  
    <nav class="md-nav" aria-label="Segment Tree">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#consultas" class="md-nav__link">
    Consultas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#atualizacoes" class="md-nav__link">
    Atualizações
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementacao_1" class="md-nav__link">
    Implementação
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#atualizacoes-em-intervalos-lazy-propagation" class="md-nav__link">
    Atualizações em Intervalos (Lazy Propagation)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#material-complementar_1" class="md-nav__link">
    Material complementar
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#disjoint-set-union-dsu" class="md-nav__link">
    Disjoint Set Union (DSU)
  </a>
  
    <nav class="md-nav" aria-label="Disjoint Set Union (DSU)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementacao_2" class="md-nav__link">
    Implementação
  </a>
  
    <nav class="md-nav" aria-label="Implementação">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#otimizacoes-do-union-find" class="md-nav__link">
    Otimizações do Union-Find
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#material-complementar_2" class="md-nav__link">
    Material complementar
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../buscaexaustiva/" class="md-nav__link">
        Busca Exaustiva
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../guloso/" class="md-nav__link">
        Algoritmos Gulosos
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../pd/" class="md-nav__link">
        Programação dinâmica
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../grafos/" class="md-nav__link">
        Grafos
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../strings/" class="md-nav__link">
        Processamento de strings
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../gc/" class="md-nav__link">
        Geometria Computacional
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="estrutura-de-dados">Estrutura de Dados</h1>
<p>Nesta parte, serão apresentados duas estruturas baseadas em árvores e uma implementação de <em>set</em> do GNU C++.  </p>
<h2 id="gnu-c-policy-based-sets">GNU C++ Policy-Based Sets</h2>
<p>O compilador GNU g++ também suporta algumas estruturas de dados que não fazem parte da biblioteca padrão do C++. Essas estruturas são chamadas de <em>estruturas de dados baseadas em políticas</em> (<a href="http://gcc.gnu.org/onlinedocs/libstdc++/manual/policy_data_structures_design.html">Policy-Based Data Structures - PBDS</a>). Para usar essas estruturas é necessário incluir o seguinte código:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ext/pb_ds/assoc_container.hpp&gt;</span><span class="cp"></span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ext/pb_ds/tree_policy.hpp&gt;</span><span class="cp"></span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">__gnu_pbds</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<p>Alternativamente, pode-se simplificar o código anterior da seguinte forma:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;bits/extc++.h&gt;</span><span class="c1"> </span><span class="cp"></span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">__gnu_pbds</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<p>Após isso, é possível definir um <strong>conjunto ordenado indexado</strong> (entre as disponíveis, essa é a principal estrutura usada em competições de programação). Esta estrutura é como o <a href="/ed1/#set-e-multiset"><em>set</em></a>, mas com a possibilidade de acessar os elementos de acordo com a sua posição (índice), como em um <em>array</em>. O código abaixo, define um conjunto ordenado indexado usando <em>template</em>.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span><span class="w"> </span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="k">using</span><span class="w"> </span><span class="n">indexed_set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tree</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">null_type</span><span class="p">,</span><span class="w"> </span><span class="n">less</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">rb_tree_tag</span><span class="p">,</span><span class="w"> </span><span class="n">tree_order_statistics_node_update</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<p>Veja alguns exemplos de uso da definição anterior:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span>
<span class="normal"><a href="#__codelineno-3-4">4</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="n">indexed_set</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">setInt</span><span class="p">;</span><span class="w">                </span><span class="c1">// Conjunto ordenado indexado de inteiros</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="n">indexed_set</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">setDouble</span><span class="p">;</span><span class="w">          </span><span class="c1">// Conjunto ordenado indexado de doubles</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="n">indexed_set</span><span class="o">&lt;</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">setPairInt</span><span class="p">;</span><span class="w"> </span><span class="c1">// Conjunto ordenado indexado de pares de inteiros</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="n">indexed_set</span><span class="o">&lt;</span><span class="n">Pessoa</span><span class="o">&gt;</span><span class="w"> </span><span class="n">setPessoa</span><span class="p">;</span><span class="w">          </span><span class="c1">// Conjunto ordenado indexado de Pessoas (precisa do operator&lt;)</span>
</code></pre></div>
</td></tr></table>
<p>Além das operações comuns do <a href="/ed1/#set-e-multiset"><em>set</em></a> (<code>insert</code>, <code>erase</code>, <code>size</code>, <code>clear</code>, <code>find</code>, <code>begin</code>, <code>end</code>), ainda existem duas funções muito úteis e que justificam o uso do PBDS:</p>
<ul>
<li><code>find_by_order(k)</code>: retorna um iterador para o <span class="arithmatex">\(k\)</span>-ésimo menor elemento (contando a partir de zero) do conjunto em tempo <span class="arithmatex">\(O(\log n)\)</span>;</li>
<li><code>order_of_key(x)</code>: retorna ao número de itens <strong>estritamente menores</strong> que o <code>x</code> em tempo <span class="arithmatex">\(O(\log n)\)</span>.</li>
</ul>
<p>Veja um exemplo completo de utilização do PBDS (Fonte: <a href="https://github.com/stevenhalim/cpbook-code/blob/master/ch2/nonlineards/pbds.cpp">pbds.cpp</a>):</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span>
<span class="normal"><a href="#__codelineno-4-18">18</a></span>
<span class="normal"><a href="#__codelineno-4-19">19</a></span>
<span class="normal"><a href="#__codelineno-4-20">20</a></span>
<span class="normal"><a href="#__codelineno-4-21">21</a></span>
<span class="normal"><a href="#__codelineno-4-22">22</a></span>
<span class="normal"><a href="#__codelineno-4-23">23</a></span>
<span class="normal"><a href="#__codelineno-4-24">24</a></span>
<span class="normal"><a href="#__codelineno-4-25">25</a></span>
<span class="normal"><a href="#__codelineno-4-26">26</a></span>
<span class="normal"><a href="#__codelineno-4-27">27</a></span>
<span class="normal"><a href="#__codelineno-4-28">28</a></span>
<span class="normal"><a href="#__codelineno-4-29">29</a></span>
<span class="normal"><a href="#__codelineno-4-30">30</a></span>
<span class="normal"><a href="#__codelineno-4-31">31</a></span>
<span class="normal"><a href="#__codelineno-4-32">32</a></span>
<span class="normal"><a href="#__codelineno-4-33">33</a></span>
<span class="normal"><a href="#__codelineno-4-34">34</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;bits/stdc++.h&gt;</span><span class="cp"></span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;bits/extc++.h&gt;</span><span class="c1"> // pbds</span><span class="cp"></span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">__gnu_pbds</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span><span class="w"> </span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="k">using</span><span class="w"> </span><span class="n">indexed_set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tree</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">null_type</span><span class="p">,</span><span class="w"> </span><span class="n">less</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">rb_tree_tag</span><span class="p">,</span><span class="w"> </span><span class="n">tree_order_statistics_node_update</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="w">  </span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">71</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">23</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">23</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">65</span><span class="p">,</span><span class="w"> </span><span class="mi">71</span><span class="p">};</span><span class="w"></span>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a><span class="w">  </span><span class="n">indexed_set</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">iset</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w">             </span><span class="c1">// O(n log n)</span>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a><span class="w">      </span><span class="n">iset</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="w"></span>
<a id="__codelineno-4-15" name="__codelineno-4-15"></a><span class="w">  </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Set size: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">iset</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">   </span><span class="c1">// 9</span>
<a id="__codelineno-4-16" name="__codelineno-4-16"></a>
<a id="__codelineno-4-17" name="__codelineno-4-17"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="n">iset</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-4-18" name="__codelineno-4-18"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-4-19" name="__codelineno-4-19"></a><span class="w">  </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-4-20" name="__codelineno-4-20"></a>
<a id="__codelineno-4-21" name="__codelineno-4-21"></a><span class="w">  </span><span class="c1">// O(log n) select</span>
<a id="__codelineno-4-22" name="__codelineno-4-22"></a><span class="w">  </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">*</span><span class="n">iset</span><span class="p">.</span><span class="n">find_by_order</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">        </span><span class="c1">// 1-smallest = 2</span>
<a id="__codelineno-4-23" name="__codelineno-4-23"></a><span class="w">  </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">*</span><span class="n">iset</span><span class="p">.</span><span class="n">find_by_order</span><span class="p">(</span><span class="n">n</span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">      </span><span class="c1">// 9-smallest/largest = 71</span>
<a id="__codelineno-4-24" name="__codelineno-4-24"></a><span class="w">  </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">*</span><span class="n">iset</span><span class="p">.</span><span class="n">find_by_order</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">        </span><span class="c1">// 5-smallest = 15</span>
<a id="__codelineno-4-25" name="__codelineno-4-25"></a><span class="w">  </span><span class="c1">// O(log n) rank</span>
<a id="__codelineno-4-26" name="__codelineno-4-26"></a><span class="w">  </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">iset</span><span class="p">.</span><span class="n">order_of_key</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">          </span><span class="c1">// index 0 (rank 1)</span>
<a id="__codelineno-4-27" name="__codelineno-4-27"></a><span class="w">  </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">iset</span><span class="p">.</span><span class="n">order_of_key</span><span class="p">(</span><span class="mi">71</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">         </span><span class="c1">// index 8 (rank 9)</span>
<a id="__codelineno-4-28" name="__codelineno-4-28"></a><span class="w">  </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">iset</span><span class="p">.</span><span class="n">order_of_key</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">         </span><span class="c1">// index 4 (rank 5)</span>
<a id="__codelineno-4-29" name="__codelineno-4-29"></a>
<a id="__codelineno-4-30" name="__codelineno-4-30"></a><span class="w">  </span><span class="n">iset</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-4-31" name="__codelineno-4-31"></a><span class="w">  </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Set size: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">iset</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">   </span><span class="c1">// 8</span>
<a id="__codelineno-4-32" name="__codelineno-4-32"></a>
<a id="__codelineno-4-33" name="__codelineno-4-33"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-4-34" name="__codelineno-4-34"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<p>Complemente sua leitura e seu conhecimento:</p>
<ul>
<li><a href="https://www.geeksforgeeks.org/ordered-set-gnu-c-pbds/">Ordered Set and GNU C++ PBDS (GeeksforGeeks)</a></li>
<li><a href="https://codeforces.com/blog/entry/11080">C++ STL: Policy based data structures</a></li>
<li><a href="https://opensource.apple.com/source/llvmgcc42/llvmgcc42-2336.9/libstdc++-v3/testsuite/ext/pb_ds/example/">PBDS Examples</a></li>
</ul>
<h2 id="fenwick-binary-indexed-tree">Fenwick (Binary Indexed) Tree</h2>
<p>Considere o seguinte problema:</p>
<div class="admonition example">
<p>Você possui <span class="arithmatex">\(n\)</span> caixas com bolinhas de gude e deseja:</p>
<ol>
<li>
<p>Adicionar bolinhas de gude a caixa <span class="arithmatex">\(i\)</span>;</p>
</li>
<li>
<p>Saber a quantidade de bolinhas de gude que existem da caixa <span class="arithmatex">\(a\)</span> até a caixa <span class="arithmatex">\(b\)</span>, ou seja, a soma das bolinhas nas caixas <span class="arithmatex">\([a, a+1, a+2, \dots, b]\)</span>.</p>
</li>
</ol>
</div>
<p>O objetivo é implementar essas duas operações de forma eficiente. Esse problema é conhecido como <strong>Range Sum Queries (RSQ)</strong>.</p>
<p>Uma abordagem ingênua, mostrada abaixo, possui <span class="arithmatex">\(O(1)\)</span> para a operação 1 e <span class="arithmatex">\(O(n)\)</span> para a 2. Se forem feitas <span class="arithmatex">\(m\)</span> operações 2, no pior caso, a complexidade de tempo será <span class="arithmatex">\(O(n*m)\)</span>.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span><span class="w"> </span><span class="n">caixas</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="kt">void</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">caixas</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// O(1)</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">    </span><span class="n">caixas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="p">}</span><span class="w"></span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="kt">void</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">caixas</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">b</span><span class="p">){</span><span class="w"> </span><span class="c1">// O(n)</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="w">    </span><span class="n">ll</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="w">        </span><span class="n">s</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">caixas</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">s</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<p>Para responder <em>range sum queries</em> em sequências dinâmicas com melhor complexidade é preciso usar estruturas mais sofisticadas, que permitam a atualização das somas pré-computadas de forma eficiente. Uma destas estruturas é a <strong>Binary Indexed Tree</strong> (<strong>BIT</strong> ou <strong>Fenwick Tree</strong>), proposta por <a href="https://api.semanticscholar.org/CorpusID:7519761">Peter M. Fenwick em 1994</a>. Usando BIT, ambas as operações são feitas em <span class="arithmatex">\(O(\log n)\)</span>.</p>
<p>A ideia da BIT é que, assim como um número pode ser representado como uma soma de algumas potências de dois, uma soma cumulativa pode ser representada como uma soma de algumas somas cumulativas parciais. Para isso, cada índice <span class="arithmatex">\(i\)</span> no array de soma cumulativa é responsável pela soma cumulativa do índice <span class="arithmatex">\(i\)</span> até <span class="arithmatex">\((i - (1&lt;&lt;r) + 1)\)</span>, onde <span class="arithmatex">\(r\)</span> representa a posição do último bit 1 da representação binária de <span class="arithmatex">\(i\)</span> (o <span class="arithmatex">\(p(i) = (1&lt;&lt;r)\)</span> também pode ser visto como a maior potência de <span class="arithmatex">\(2\)</span> que divide <span class="arithmatex">\(i\)</span>). Por exemplo, o índice <span class="arithmatex">\(15_{10} = 1111_2\)</span> ficará responsável pela soma do intervalo <span class="arithmatex">\(15 - (1&lt;&lt;0) + 1 = 15 - 1 + 1\)</span> a <span class="arithmatex">\(15\)</span>. Já o índice <span class="arithmatex">\(12_{10} = 1100_2\)</span> ficará responsável pela soma do intervalo <span class="arithmatex">\(12 - (1&lt;&lt;3) + 1 = 12 - 8 + 1 = 9\)</span> a <span class="arithmatex">\(12\)</span>, e assim por diante. A tabela abaixo mostra a responsabilidade dos índices 1 a 16.</p>
<table>
<thead>
<tr>
<th align="center">Índice</th>
<th align="center">Responsável pela soma parcial do intervalo</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">16</td>
<td align="center">[01, 16]</td>
</tr>
<tr>
<td align="center">15</td>
<td align="center">[15, 15]</td>
</tr>
<tr>
<td align="center">14</td>
<td align="center">[13, 14]</td>
</tr>
<tr>
<td align="center">13</td>
<td align="center">[13, 13]</td>
</tr>
<tr>
<td align="center">12</td>
<td align="center">[09, 12]</td>
</tr>
<tr>
<td align="center">11</td>
<td align="center">[11, 11]</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">[09, 10]</td>
</tr>
<tr>
<td align="center">09</td>
<td align="center">[09, 09]</td>
</tr>
<tr>
<td align="center">08</td>
<td align="center">[01, 08]</td>
</tr>
<tr>
<td align="center">07</td>
<td align="center">[07, 07]</td>
</tr>
<tr>
<td align="center">06</td>
<td align="center">[05, 06]</td>
</tr>
<tr>
<td align="center">05</td>
<td align="center">[05, 05]</td>
</tr>
<tr>
<td align="center">04</td>
<td align="center">[01, 04]</td>
</tr>
<tr>
<td align="center">03</td>
<td align="center">[03, 03]</td>
</tr>
<tr>
<td align="center">02</td>
<td align="center">[01, 02]</td>
</tr>
<tr>
<td align="center">01</td>
<td align="center">[01, 01]</td>
</tr>
</tbody>
</table>
<p>Perceba que todo índices ímpar fica responsável por um intervalo de tamanho 1 (porquê?). Já os índices <span class="arithmatex">\(i\)</span> que são potência de 2, ficam responsáveis pelo intervalo <span class="arithmatex">\([1, i]\)</span>.</p>
<p>Tipicamente, a Fenwick Tree é implementada usando um array (<code>vector</code>), digamos <code>ft</code>, de modo que:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="n">ft</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span><span class="w"> </span>
</code></pre></div>
</td></tr></table>
<p>Assim, cada posição <code>i</code> contém a soma dos valores de um intervalo do array original cujo comprimento é <code>p(i)</code> e que termina na posição <code>i</code>. Por exemplo, como <code>p(6) = 2</code>, <code>ft[6]</code> contém o valor de <code>sum(5,6)</code>. </p>
<p>Considere o seguinte array original:</p>
<figure>
<p><img src="/img/FT1.png" style="width:80%;display: block; margin: 0 auto;"/></p>
</figure>
<p>A Fenwick Tree correspondente é a seguinte:</p>
<figure>
<p><img src="/img/FT2.png" style="width:80%;display: block; margin: 0 auto;"/></p>
</figure>
<p>A figura abaixo mostra mais claramente como cada valor na BIT corresponde a um intervalo no array original:</p>
<figure>
<p><img src="/img/FT3.png" style="width:80%;display: block; margin: 0 auto;"/></p>
</figure>
<p>Usando uma BIT, qualquer valor de <code>sum(1,i)</code> pode ser calculado em tempo <span class="arithmatex">\(O(\log n)\)</span>, pois um intervalo <span class="arithmatex">\([1,i]\)</span> sempre pode ser dividido em intervalos <span class="arithmatex">\(O(\log n)\)</span> cujas somas são armazenadas na árvore. Por exemplo, o intervalo <span class="arithmatex">\([1,7]\)</span> consiste nos seguintes intervalos:</p>
<figure>
<p><img src="/img/FT4.png" style="width:80%;display: block; margin: 0 auto;"/></p>
</figure>
<p>Assim, pode-se calcular a soma correspondente da seguinte forma:</p>
<div class="arithmatex">\[
sum(1,7) = sum(1,4)+sum(5,6)+sum(7,7) = 16+7+4 = 27
\]</div>
<p>Para calcular o valor de <span class="arithmatex">\(sum(a,b)\)</span> onde <span class="arithmatex">\(a &gt; 1\)</span>, pode-se usar o mesmo truque que usado na soma de prefixo:</p>
<div class="arithmatex">\[
sum(a,b) = sum(1,b)−sum(1,a−1).
\]</div>
<p>Como pode-se calcular tanto <span class="arithmatex">\(sum(1, b)\)</span> quanto <span class="arithmatex">\(sum(1, a−1)\)</span> em tempo <span class="arithmatex">\(O(\log n)\)</span>, a complexidade de tempo total é <span class="arithmatex">\(O(\log n)\)</span>.</p>
<p>Além de calcular a soma parcial, também é possível/necessário atualizar o valor de uma determinada posição no array original. Após a atualização, alguns valores na BIT devem ser atualizados. Por exemplo, se o valor na posição 3 mudar, as somas dos seguintes intervalos mudam:</p>
<figure>
<p><img src="/img/FT5.png" style="width:80%;display: block; margin: 0 auto;"/></p>
</figure>
<p>Como cada elemento do array pertence a <span class="arithmatex">\(O(\log n)\)</span> intervalos na BIT, basta atualizar os <span class="arithmatex">\(O(\log n)\)</span> valores na árvore.</p>
<h3 id="implementacao">Implementação</h3>
<p>O primeiro passo é definir como calcular o valor de <code>p(i)</code>, ou seja, a maior potência de <span class="arithmatex">\(2\)</span> que divide <span class="arithmatex">\(i\)</span>. Este valor é conhecido como o <strong>bit menos significativo</strong>, abreviado <em>lsb</em>, da representação binária de <span class="arithmatex">\(i\)</span>. O função abaixo calcula esse valor:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span>
<span class="normal"><a href="#__codelineno-7-2">2</a></span>
<span class="normal"><a href="#__codelineno-7-3">3</a></span>
<span class="normal"><a href="#__codelineno-7-4">4</a></span>
<span class="normal"><a href="#__codelineno-7-5">5</a></span>
<span class="normal"><a href="#__codelineno-7-6">6</a></span>
<span class="normal"><a href="#__codelineno-7-7">7</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">p</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">bit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">i</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">bit</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="w">        </span><span class="o">++</span><span class="n">bit</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">bit</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<p>Essa função possui complexidade <span class="arithmatex">\(O(\log n)\)</span>. Entretanto, usando <a href="../manipulacaobits/#alguns-truques-e-aplicacoes">manipulação de bits</a>, pode-se encontrar esse valor de forma mais eficiente. Lembre-se que um número negativo é representado usando complemento de 2, ou seja, pega-se a representação binária de <code>x</code>, inverte-se os bits e adiciona 1 (ignorando o resto final). Por exemplo, considere <code>x = 108</code> e que os valores são representados em 8 bits:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span>
<span class="normal"><a href="#__codelineno-8-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a> <span class="nv">x</span> <span class="o">=</span> <span class="m">01101100</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a>~x <span class="o">=</span> <span class="m">10010011</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a>-x <span class="o">=</span> <span class="m">10010100</span> 
</code></pre></div>
</td></tr></table>
<p>Observe que os bits mais significativos que o <em>lsb</em> são diferentes para <code>x</code> e <code>-x</code>, enquanto o <em>lsb</em> e os 0s seguintes são os mesmos. Portanto, <code>x &amp; −x</code> dá a resposta desejada, ou seja: <code>x &amp; -x = 00000100</code>. Com essa estratégia, pode-se calcular o valor de <em>lsb</em>, consequentemente, o valor de <code>p(i)</code> em <span class="arithmatex">\(O(1)\)</span>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span>
<span class="normal"><a href="#__codelineno-9-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">lsb</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (1)</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="o">-</span><span class="n">i</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<ol>
<li>Normalmente, essa função é feita como uma macro: <code class="highlight"><span class="cp">#define lsb(i) ((i) &amp; -(i))</span></code></li>
</ol>
<p>A funções a seguir calculam o valor de <span class="arithmatex">\(sum(1,i)\)</span> e <span class="arithmatex">\(sum(a, b)\)</span>, respectivamente:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span>
<span class="normal"><a href="#__codelineno-10-11">11</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="w">        </span><span class="n">s</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">ft</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="w">        </span><span class="n">i</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">lsb</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">s</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="p">}</span><span class="w"></span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="mi">-1</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-10-11" name="__codelineno-10-11"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<p>A seguinte função aumenta o valor do array na posição <span class="arithmatex">\(i\)</span> em <span class="arithmatex">\(x\)</span> (<span class="arithmatex">\(x\)</span> pode ser positivo ou negativo):</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span>
<span class="normal"><a href="#__codelineno-11-2">2</a></span>
<span class="normal"><a href="#__codelineno-11-3">3</a></span>
<span class="normal"><a href="#__codelineno-11-4">4</a></span>
<span class="normal"><a href="#__codelineno-11-5">5</a></span>
<span class="normal"><a href="#__codelineno-11-6">6</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Normalmente, essa função também é chamada de update</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ft</span><span class="p">.</span><span class="n">size</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="w">        </span><span class="n">ft</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="w">        </span><span class="n">i</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">lsb</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<p>Para construir a BIT a partir de um array original, uma primeira estratégia é iniciar o array <code>ft</code> com valor 0 em todas as posições. Em seguida, para cada posição <span class="arithmatex">\(i\)</span>, chama-se a função <code>add</code> passando o valor do array original como valor a ser incrementado, o que daria resultaria em <span class="arithmatex">\(O(n \log n)\)</span> operações. Veja a função abaixo:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span>
<span class="normal"><a href="#__codelineno-12-3">3</a></span>
<span class="normal"><a href="#__codelineno-12-4">4</a></span>
<span class="normal"><a href="#__codelineno-12-5">5</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="w">    </span><span class="n">ft</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="w">          </span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="w"></span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<p>Entretanto, note que após atualizar o valor de <code>ft[i]</code>, pode-se verificar se o "pai" de <span class="arithmatex">\(i\)</span> é menor que <span class="arithmatex">\(N\)</span> (tamanho do array). Se for, atualiza-se o "pai" também. Dessa forma, temos uma função com complexidade <span class="arithmatex">\(O(n)\)</span>.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span>
<span class="normal"><a href="#__codelineno-13-3">3</a></span>
<span class="normal"><a href="#__codelineno-13-4">4</a></span>
<span class="normal"><a href="#__codelineno-13-5">5</a></span>
<span class="normal"><a href="#__codelineno-13-6">6</a></span>
<span class="normal"><a href="#__codelineno-13-7">7</a></span>
<span class="normal"><a href="#__codelineno-13-8">8</a></span>
<span class="normal"><a href="#__codelineno-13-9">9</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="w">    </span><span class="n">ll</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ll</span><span class="p">)</span><span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">    </span><span class="n">ft</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">m</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="w">          </span><span class="n">ft</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lsb</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="w">              </span><span class="n">ft</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lsb</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<p>Também é possível encontrar o menor índice <span class="arithmatex">\(i\)</span> tal que soma acumulativa do intervalo <span class="arithmatex">\([1..i] \geq k\)</span>. Como as somas acumulativas dos valores estão ordenadas, pode-se usar a busca binária para encontrar tal índice. Basicamente, testa-se o índice do meio <span class="arithmatex">\(m = n / 2\)</span> do intervalo inicial <span class="arithmatex">\([1..n]\)</span> e verifica se <code>sum(1, i)</code> é menor que <span class="arithmatex">\(k\)</span> ou não. Para cada valor de <span class="arithmatex">\(m\)</span>, tem-se <span class="arithmatex">\(O(\log n)\)</span> operações, logo, essa função terá complexidade <span class="arithmatex">\(O(\log n \times \log n) = O(\log^2 n)\)</span>. O código abaixo ilustra tal função:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span>
<span class="normal"><a href="#__codelineno-14-2">2</a></span>
<span class="normal"><a href="#__codelineno-14-3">3</a></span>
<span class="normal"><a href="#__codelineno-14-4">4</a></span>
<span class="normal"><a href="#__codelineno-14-5">5</a></span>
<span class="normal"><a href="#__codelineno-14-6">6</a></span>
<span class="normal"><a href="#__codelineno-14-7">7</a></span>
<span class="normal"><a href="#__codelineno-14-8">8</a></span>
<span class="normal"><a href="#__codelineno-14-9">9</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="n">ll</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="w">    </span><span class="n">ll</span><span class="w"> </span><span class="n">ini</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">fim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ft</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">30</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (1)</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="w">        </span><span class="n">ll</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ini</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fim</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="n">ini</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="n">fim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">fim</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<ol>
<li><span class="arithmatex">\(2^{30} &gt; 10^9\)</span>, normalmente é suficiente.</li>
</ol>
<p>O código abaixo mostra uma implementação completa de uma BIT. Note que foi usado uma versão baseada em orientação à objetos, mas isso não é necessário.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span>
<span class="normal"><a href="#__codelineno-15-14">14</a></span>
<span class="normal"><a href="#__codelineno-15-15">15</a></span>
<span class="normal"><a href="#__codelineno-15-16">16</a></span>
<span class="normal"><a href="#__codelineno-15-17">17</a></span>
<span class="normal"><a href="#__codelineno-15-18">18</a></span>
<span class="normal"><a href="#__codelineno-15-19">19</a></span>
<span class="normal"><a href="#__codelineno-15-20">20</a></span>
<span class="normal"><a href="#__codelineno-15-21">21</a></span>
<span class="normal"><a href="#__codelineno-15-22">22</a></span>
<span class="normal"><a href="#__codelineno-15-23">23</a></span>
<span class="normal"><a href="#__codelineno-15-24">24</a></span>
<span class="normal"><a href="#__codelineno-15-25">25</a></span>
<span class="normal"><a href="#__codelineno-15-26">26</a></span>
<span class="normal"><a href="#__codelineno-15-27">27</a></span>
<span class="normal"><a href="#__codelineno-15-28">28</a></span>
<span class="normal"><a href="#__codelineno-15-29">29</a></span>
<span class="normal"><a href="#__codelineno-15-30">30</a></span>
<span class="normal"><a href="#__codelineno-15-31">31</a></span>
<span class="normal"><a href="#__codelineno-15-32">32</a></span>
<span class="normal"><a href="#__codelineno-15-33">33</a></span>
<span class="normal"><a href="#__codelineno-15-34">34</a></span>
<span class="normal"><a href="#__codelineno-15-35">35</a></span>
<span class="normal"><a href="#__codelineno-15-36">36</a></span>
<span class="normal"><a href="#__codelineno-15-37">37</a></span>
<span class="normal"><a href="#__codelineno-15-38">38</a></span>
<span class="normal"><a href="#__codelineno-15-39">39</a></span>
<span class="normal"><a href="#__codelineno-15-40">40</a></span>
<span class="normal"><a href="#__codelineno-15-41">41</a></span>
<span class="normal"><a href="#__codelineno-15-42">42</a></span>
<span class="normal"><a href="#__codelineno-15-43">43</a></span>
<span class="normal"><a href="#__codelineno-15-44">44</a></span>
<span class="normal"><a href="#__codelineno-15-45">45</a></span>
<span class="normal"><a href="#__codelineno-15-46">46</a></span>
<span class="normal"><a href="#__codelineno-15-47">47</a></span>
<span class="normal"><a href="#__codelineno-15-48">48</a></span>
<span class="normal"><a href="#__codelineno-15-49">49</a></span>
<span class="normal"><a href="#__codelineno-15-50">50</a></span>
<span class="normal"><a href="#__codelineno-15-51">51</a></span>
<span class="normal"><a href="#__codelineno-15-52">52</a></span>
<span class="normal"><a href="#__codelineno-15-53">53</a></span>
<span class="normal"><a href="#__codelineno-15-54">54</a></span>
<span class="normal"><a href="#__codelineno-15-55">55</a></span>
<span class="normal"><a href="#__codelineno-15-56">56</a></span>
<span class="normal"><a href="#__codelineno-15-57">57</a></span>
<span class="normal"><a href="#__codelineno-15-58">58</a></span>
<span class="normal"><a href="#__codelineno-15-59">59</a></span>
<span class="normal"><a href="#__codelineno-15-60">60</a></span>
<span class="normal"><a href="#__codelineno-15-61">61</a></span>
<span class="normal"><a href="#__codelineno-15-62">62</a></span>
<span class="normal"><a href="#__codelineno-15-63">63</a></span>
<span class="normal"><a href="#__codelineno-15-64">64</a></span>
<span class="normal"><a href="#__codelineno-15-65">65</a></span>
<span class="normal"><a href="#__codelineno-15-66">66</a></span>
<span class="normal"><a href="#__codelineno-15-67">67</a></span>
<span class="normal"><a href="#__codelineno-15-68">68</a></span>
<span class="normal"><a href="#__codelineno-15-69">69</a></span>
<span class="normal"><a href="#__codelineno-15-70">70</a></span>
<span class="normal"><a href="#__codelineno-15-71">71</a></span>
<span class="normal"><a href="#__codelineno-15-72">72</a></span>
<span class="normal"><a href="#__codelineno-15-73">73</a></span>
<span class="normal"><a href="#__codelineno-15-74">74</a></span>
<span class="normal"><a href="#__codelineno-15-75">75</a></span>
<span class="normal"><a href="#__codelineno-15-76">76</a></span>
<span class="normal"><a href="#__codelineno-15-77">77</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;bits/stdc++.h&gt;</span><span class="cp"></span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="k">typedef</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w">  </span><span class="n">ll</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="k">typedef</span><span class="w"> </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span><span class="w"> </span><span class="n">vll</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="cp">#define lsb(i) ((i) &amp; -(i))</span>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="k">class</span><span class="w">  </span><span class="nc">FenwickTree</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="k">private</span><span class="o">:</span><span class="w"></span>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="w">    </span><span class="n">vll</span><span class="w"> </span><span class="n">ft</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="k">public</span><span class="o">:</span><span class="w"></span>
<a id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="w">    </span><span class="n">FenwickTree</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">ft</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-15-14" name="__codelineno-15-14"></a><span class="w">    </span><span class="n">FenwickTree</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">vll</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">build</span><span class="p">(</span><span class="n">a</span><span class="p">);</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-15-15" name="__codelineno-15-15"></a>
<a id="__codelineno-15-16" name="__codelineno-15-16"></a><span class="w">    </span><span class="n">ll</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-15-17" name="__codelineno-15-17"></a><span class="w">        </span><span class="n">ll</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-15-18" name="__codelineno-15-18"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-15-19" name="__codelineno-15-19"></a><span class="w">            </span><span class="n">s</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">ft</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>
<a id="__codelineno-15-20" name="__codelineno-15-20"></a><span class="w">            </span><span class="n">i</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">lsb</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-15-21" name="__codelineno-15-21"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-15-22" name="__codelineno-15-22"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">s</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-15-23" name="__codelineno-15-23"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-15-24" name="__codelineno-15-24"></a><span class="w">    </span><span class="n">ll</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-15-25" name="__codelineno-15-25"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="mi">-1</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-15-26" name="__codelineno-15-26"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-15-27" name="__codelineno-15-27"></a>
<a id="__codelineno-15-28" name="__codelineno-15-28"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-15-29" name="__codelineno-15-29"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">ll</span><span class="p">)</span><span class="n">ft</span><span class="p">.</span><span class="n">size</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-15-30" name="__codelineno-15-30"></a><span class="w">            </span><span class="n">ft</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-15-31" name="__codelineno-15-31"></a><span class="w">            </span><span class="n">i</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">lsb</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-15-32" name="__codelineno-15-32"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-15-33" name="__codelineno-15-33"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-15-34" name="__codelineno-15-34"></a>
<a id="__codelineno-15-35" name="__codelineno-15-35"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">build</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">vll</span><span class="o">&amp;</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-15-36" name="__codelineno-15-36"></a><span class="w">        </span><span class="n">ll</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ll</span><span class="p">)</span><span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-15-37" name="__codelineno-15-37"></a><span class="w">        </span><span class="n">ft</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-15-38" name="__codelineno-15-38"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">m</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-15-39" name="__codelineno-15-39"></a><span class="w">              </span><span class="n">ft</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>
<a id="__codelineno-15-40" name="__codelineno-15-40"></a><span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lsb</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-15-41" name="__codelineno-15-41"></a><span class="w">                  </span><span class="n">ft</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lsb</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">ft</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>
<a id="__codelineno-15-42" name="__codelineno-15-42"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-15-43" name="__codelineno-15-43"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-15-44" name="__codelineno-15-44"></a>
<a id="__codelineno-15-45" name="__codelineno-15-45"></a><span class="w">    </span><span class="n">ll</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-15-46" name="__codelineno-15-46"></a><span class="w">        </span><span class="n">ll</span><span class="w"> </span><span class="n">ini</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">fim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ll</span><span class="p">)</span><span class="n">ft</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-15-47" name="__codelineno-15-47"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">30</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-15-48" name="__codelineno-15-48"></a><span class="w">            </span><span class="n">ll</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ini</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">fim</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ini</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-15-49" name="__codelineno-15-49"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="n">ini</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-15-50" name="__codelineno-15-50"></a><span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="n">fim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-15-51" name="__codelineno-15-51"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-15-52" name="__codelineno-15-52"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">fim</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-15-53" name="__codelineno-15-53"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-15-54" name="__codelineno-15-54"></a><span class="p">};</span><span class="w"></span>
<a id="__codelineno-15-55" name="__codelineno-15-55"></a>
<a id="__codelineno-15-56" name="__codelineno-15-56"></a>
<a id="__codelineno-15-57" name="__codelineno-15-57"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-15-58" name="__codelineno-15-58"></a><span class="w">    </span><span class="c1">//          1  2  3  4  5  6  7  8</span>
<a id="__codelineno-15-59" name="__codelineno-15-59"></a><span class="w">    </span><span class="n">vll</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">};</span><span class="w"> </span><span class="c1">// Indice 0 não é utilizado</span>
<a id="__codelineno-15-60" name="__codelineno-15-60"></a><span class="w">    </span><span class="n">FenwickTree</span><span class="w"> </span><span class="n">ft</span><span class="p">(</span><span class="n">f</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-15-61" name="__codelineno-15-61"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ft</span><span class="p">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">   </span><span class="c1">// ft[8] = 29</span>
<a id="__codelineno-15-62" name="__codelineno-15-62"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ft</span><span class="p">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">   </span><span class="c1">// ft[3] + ft[2] = 4 + 4 = 8</span>
<a id="__codelineno-15-63" name="__codelineno-15-63"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ft</span><span class="p">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">   </span><span class="c1">// ft[7] + ft[6] + ft[4] = 16 + 7 + 4 = 27</span>
<a id="__codelineno-15-64" name="__codelineno-15-64"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ft</span><span class="p">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">   </span><span class="c1">// sum(1, 4) - sum(1, 1) = ft[4] - ft[1] = 16 - 1 = 15</span>
<a id="__codelineno-15-65" name="__codelineno-15-65"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ft</span><span class="p">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">   </span><span class="c1">// sum(1, 8) - sum(1, 5) = ft[8] - (ft[5] + ft[4]) = 29 - (6 + 16) = 7</span>
<a id="__codelineno-15-66" name="__codelineno-15-66"></a><span class="w">    </span><span class="n">ft</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w">                   </span><span class="c1">// Aumenta em duas unidades o valor da posição 8</span>
<a id="__codelineno-15-67" name="__codelineno-15-67"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ft</span><span class="p">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">   </span><span class="c1">// ft[8] = 31</span>
<a id="__codelineno-15-68" name="__codelineno-15-68"></a><span class="w">    </span><span class="n">ft</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">-2</span><span class="p">);</span><span class="w">                  </span><span class="c1">// Reduz em duas unidades o valor da posição 8</span>
<a id="__codelineno-15-69" name="__codelineno-15-69"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ft</span><span class="p">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">   </span><span class="c1">// ft[8] = 29</span>
<a id="__codelineno-15-70" name="__codelineno-15-70"></a><span class="w">    </span><span class="n">ft</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="p">[</span><span class="mi">8</span><span class="p">]);</span><span class="w">               </span><span class="c1">// Zera o valor da posição 8</span>
<a id="__codelineno-15-71" name="__codelineno-15-71"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ft</span><span class="p">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">   </span><span class="c1">// ft[8] = 27</span>
<a id="__codelineno-15-72" name="__codelineno-15-72"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ft</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">   </span><span class="c1">// Indice 2, sum(1, 2) == 4, que é &gt;= 4</span>
<a id="__codelineno-15-73" name="__codelineno-15-73"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ft</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">   </span><span class="c1">// Indice 3, sum(1, 3) == 8, que é &gt;= 8</span>
<a id="__codelineno-15-74" name="__codelineno-15-74"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ft</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">  </span><span class="c1">// Indice 7, sum(1, 7) == 27, que é &gt;= 25</span>
<a id="__codelineno-15-75" name="__codelineno-15-75"></a>
<a id="__codelineno-15-76" name="__codelineno-15-76"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-15-77" name="__codelineno-15-77"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<h3 id="quando-usar">Quando usar?</h3>
<p>Para utilizar uma árvore de Fenwick para realizar a operação <span class="arithmatex">\(\odot\)</span> em um intervalo de índices <span class="arithmatex">\([i,j]\)</span> da sequência <span class="arithmatex">\(a_k\)</span>, é necessário que esta operação tenha duas propriedades:</p>
<ol>
<li>
<p>Associatividade: para quaisquer <span class="arithmatex">\(x, y, z \in a_k\)</span>, deve valer que: <span class="arithmatex">\((x \odot y)\odot z = x \odot (y \odot z)\)</span>;</p>
</li>
<li>
<p>Invertibilidade: para qualquer <span class="arithmatex">\(x \in a_k\)</span>, deve existir um valor <span class="arithmatex">\(y\)</span> tal que <span class="arithmatex">\(x\odot y = I\)</span>, onde <span class="arithmatex">\(I\)</span> é o elemento neutro/identidade da operação <span class="arithmatex">\(\odot\)</span>.</p>
</li>
</ol>
<p>Como exemplos de operações que têm ambas propriedades tem-se a adição e a multiplicação de racionais, a adição de matrizes e o ou exclusivo (xor).</p>
<h3 id="material-complementar">Material complementar</h3>
<ul>
<li><a href="https://www.geeksforgeeks.org/binary-indexed-tree-or-fenwick-tree-2/">Binary Indexed Tree or Fenwick Tree (GeeksforGeeks)</a></li>
<li><a href="https://cp-algorithms.com/data_structures/fenwick.html">Fenwick Tree</a></li>
<li><a href="https://www.topcoder.com/thrive/articles/Binary%20Indexed%20Trees">Binary Indexed Trees (Topcoder)</a></li>
<li><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg></span> <a href="https://www.youtube.com/watch?v=uSFzHCZ4E-8">Fenwick Tree (Binary Index Tree) - Quick Tutorial and Source Code Explanation</a></li>
<li><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg></span> <a href="https://www.youtube.com/watch?v=v_wj_mOAlig">Tutorial: Binary Indexed Tree (Fenwick Tree)</a></li>
<li><a href="https://visualgo.net/en/fenwicktree">Binary Indexed (Fenwick) Tree - VisuAlgo</a></li>
</ul>
<h2 id="segment-tree">Segment Tree</h2>
<p><strong>Segment tree</strong> (Árvore de Segmento ou <em>SegTree</em>) é outra estrutura de dados para lidar com problemas de consulta em intervalos. O que torna as SegTrees poderosas é sua capacidade de fazer atualização e consulta em intervalos com complexidade <span class="arithmatex">\(O(\log n)\)</span>, além do tipo da consulta ser bem abrangente. Entretanto, comparada a BIT, uma SegTree requer mais memória e é um pouco mais difícil de implementar.</p>
<p>A ideia da SegTree é a seguinte: cria-se uma árvore de forma que cada nó representa a informação que deseja-se saber a respeito de um segmento do vetor (por exemplo, a soma). Cada nó (exceto as folhas) possui dois filhos, um filho representa a metade esquerda do intervalo e o outro, a metade direita. Esse processo repete-se (recursivamente) até que os intervalos atinjam tamanho 1. Assim, considerando o <em>Range Sum Queries</em> (RSQ), o nó raíz da árvore armazena a soma de todo o array, ou seja, a soma do segmento <span class="arithmatex">\(a[0 \dots n-1]\)</span>. Em seguida, essa segmento é dividido em dois: o filho da esquerda fica responsável pelo calcular/armazenar a soma da metade da esquerda do segmento (ou seja, <span class="arithmatex">\(a[0 \dots n/2]\)</span>) e o filho da direita responsável pela metade da direita do segmento (ou seja, <span class="arithmatex">\(a[n/2+1 \dots n-1]\)</span>). Cada um desses nós é novamente dividido e calcula-se a soma de cada novo intervalo. Repete-se o processo até todos os segmentos atingirem tamanho 1. Nesse <a href="https://visualgo.net/en/segmenttree">link</a> você encontra uma demonstração visual de como a SegTree funciona.</p>
<p>Veja uma representação visual de uma SegTree para o array <code>a = [1,3,−2,8,−7]</code>:</p>
<figure>
<p><img src="/img/sum-segment-tree.png" alt="SegTree" style="width:80%;display: block; margin: 0 auto;"/>
  </p>
<figcaption style="font-size=8pt">Fonte: <a href="https://cp-algorithms.com/data_structures/segment_tree.html">Algorithms for Competitive Programming</a></figcaption>
</figure>
<p>Note que o primeiro nível da árvore contém um único nó (a raiz), o segundo nível contém 2 nós, no terceiro contém 4, e assim por diante, até que o número de nós alcance <span class="arithmatex">\(n\)</span>. Portanto, o número de nós, no pior caso, pode ser estimado pela soma <span class="arithmatex">\(1+2+4+\cdots+2^{\lceil \log_2 n \rceil}=2^{ \lceil \log_2 n \rceil+1} &lt; 4n\)</span>.</p>
<h3 id="consultas">Consultas</h3>
<p>Suponha que deseja-se fazer uma consulta (por exemplo, calcular a soma, valor mínimo/máximo, etc.) no intervalo <span class="arithmatex">\(l\)</span> e <span class="arithmatex">\(r\)</span>, ou seja, deseja-se fazer um consulta no segmento <span class="arithmatex">\(a[l \dots r]\)</span>. Para isso, deve-se percorrer a árvore de segmentos e usar os valores pré-computados dos segmentos. Considere que a consulta esteja no vértice que cobre o segmento <span class="arithmatex">\(a[tl \dots tr]\)</span>. Existem três possibilidades:</p>
<ol>
<li>
<p>O nó está fora do intervalo de interesse, ou seja, <code class="highlight"><span class="n">tr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">tl</span><span class="w"></span></code>. Retorne um valor neutro que não afete a cunsulta (por exemplo, se a operação for a soma, retorne 0);</p>
</li>
<li>
<p>O nó está completamente incluído no intervalos de interesse, ou seja, <code class="highlight"><span class="n">tl</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">tr</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">r</span><span class="w"></span></code>. Retorne a informação armazenada no nó;</p>
</li>
<li>
<p>O nó está parcialmente contido no intervalo de interesse, ou seja, <code class="highlight"><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">tr</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">tr</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">tl</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">tl</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"></span></code>. Então, a consulta continua nos nós filhos.</p>
</li>
</ol>
<!-- 1. O segmento $a[l \dots r]$ é igual ao segmento correspondente do nó atual, ou seja, $a[l \dots r]=a[tl \dots tr]$. Neste caso, retorne o valor pré-computado que está armazenado no nó;

2. O segmento da consulta está completamente no domínio do filho esquerdo ou direito.

3. -->

<p>A figura abaixo ilustra esse processo para encontrar a soma do segmento <span class="arithmatex">\(a[2 \dots 4]\)</span> para o array <code>a = [1,3,−2,8,−7]</code>. Os nós coloridos serão visitados e usa-se os valores pré-calculados dos nós verdes. Assim, o resultado será <span class="arithmatex">\(−2 + 1=−1\)</span>. O número de nós visitados é proporcional à altura da árvore, ou seja, <span class="arithmatex">\(O(\log n)\)</span>.</p>
<figure>
<p><img src="/img/sum-segment-tree-query.png" alt="SegTree Query" style="width:80%;display: block; margin: 0 auto;"/>
  </p>
<figcaption style="font-size=8pt">Fonte: <a href="https://cp-algorithms.com/data_structures/segment_tree.html">Algorithms for Competitive Programming</a></figcaption>
</figure>
<h3 id="atualizacoes">Atualizações</h3>
<p>Fazer uma atualização no array original (por exemplo, fazer <code>a[i] = x</code>) implica que a SegTree também deve ter alguns nós atualizados, de modo que ela corresponda ao novo array modificado. Perceba que cada nível de uma SegTree forma uma partição do array. Portanto, um elemento <code>a[i]</code> apenas contribui para <strong>um</strong> segmento de cada nível. Assim, apenas <span class="arithmatex">\(O(\log n)\)</span> nós necessitam ser atualizadas.</p>
<p>A atualização dos elementos pode ser facilmente implementada usando uma função recursiva. A função passa pelo nó atual da árvore e recursivamente chama a si mesma com um dos dois nós filhos (aquele que contém <code>a[i]</code> em seu segmento) e, em seguida, recalcula seu valor.</p>
<p>Considerando a SegTree do array <code>a = [1,3,−2,8,−7]</code>, ao fazer <code>a[2] = 3</code>, os nós verdes são os nós visitados e atualizados.</p>
<figure>
<p><img src="/img/sum-segment-tree-update.png" alt="SegTree Update" style="width:80%;display: block; margin: 0 auto;"/>
  </p>
<figcaption style="font-size=8pt">Fonte: <a href="https://cp-algorithms.com/data_structures/segment_tree.html">Algorithms for Competitive Programming</a></figcaption>
</figure>
<h3 id="implementacao_1">Implementação</h3>
<p>A primeira função a ser analisada/implementada é a <code>build</code>, responsável por criar a SegTree. Assim como na BIT, aqui também pode-se usar um array para armazenar os nós da SegTree (considere que o array se chama <code>st</code>). O índice 0 é a raíz e os filhos da esquerda e direita do índice <span class="arithmatex">\(i\)</span> são os índices <span class="arithmatex">\(2 \times i + 1\)</span> e <span class="arithmatex">\(2 \times i + 2\)</span>, respectivamente.</p>
<p>A raiz da SegTree representa o segmento completo <code>[0, n-1]</code> do array <code>A</code>. Para cada segmento <code>[L, R]</code> armazenado no índice <span class="arithmatex">\(i\)</span>, onde <code>L != R</code>, o segmento é dividido no sub-segmento <code>[L, (L+R)/2]</code> (armazenado no índice <span class="arithmatex">\(2 \times i + 1\)</span>) e sub-segmento <code>[(L+R)/2 + 1, R]</code> (armazenado no índice <span class="arithmatex">\(2 \times i + 2\)</span>). Essa divisão continua até que o segmento tenha tamanho 1 (isto é, <code>L == R</code>), o que indica que chegou-se em um nó folha e, pela definição de SegTree, esse nó deve receber o valor correspondente de <code>A</code>, ou seja, <code>st[i] = A[L]</code> ou <code>st[i] = A[R]</code>.</p>
<p>A função <code>build</code> abaixo ilustra o processo de construção de uma SegTree a partir do array <code>A</code>. Perceba que foi usada a função <code>funcao</code> para fazer a atualização dos nós da árvore. Nesse exemplo, a SegTree será responsável por realizar a soma dos elementos (RSQ).</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-16-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-16-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-16-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-16-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-16-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-16-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-16-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-16-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-16-10">10</a></span>
<span class="normal"><a href="#__codelineno-16-11">11</a></span>
<span class="normal"><a href="#__codelineno-16-12">12</a></span>
<span class="normal"><a href="#__codelineno-16-13">13</a></span>
<span class="normal"><a href="#__codelineno-16-14">14</a></span>
<span class="normal"><a href="#__codelineno-16-15">15</a></span>
<span class="normal"><a href="#__codelineno-16-16">16</a></span>
<span class="normal"><a href="#__codelineno-16-17">17</a></span>
<span class="normal"><a href="#__codelineno-16-18">18</a></span>
<span class="normal"><a href="#__codelineno-16-19">19</a></span>
<span class="normal"><a href="#__codelineno-16-20">20</a></span>
<span class="normal"><a href="#__codelineno-16-21">21</a></span>
<span class="normal"><a href="#__codelineno-16-22">22</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="cp">#define filhoEsq(i) (2*(i) + 1)</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="cp">#define filhoDir(i) (2*(i) + 2)</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">funcao</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Função usada na SegTree: soma</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="p">}</span><span class="w"></span>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="kt">void</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">R</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">L</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">R</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="w">    </span><span class="c1">//Nó (folha) que deve conter o valor de A[L] ou A[R]</span>
<a id="__codelineno-16-12" name="__codelineno-16-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">L</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">R</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-16-13" name="__codelineno-16-13"></a><span class="w">        </span><span class="n">st</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">L</span><span class="p">];</span><span class="w"></span>
<a id="__codelineno-16-14" name="__codelineno-16-14"></a><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-16-15" name="__codelineno-16-15"></a><span class="w">        </span><span class="c1">//Recursivamente constroi-se a SegTree</span>
<a id="__codelineno-16-16" name="__codelineno-16-16"></a><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">L</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">R</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">L</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-16-17" name="__codelineno-16-17"></a><span class="w">        </span><span class="n">build</span><span class="p">(</span><span class="n">filhoEsq</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="w">     </span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-16-18" name="__codelineno-16-18"></a><span class="w">        </span><span class="n">build</span><span class="p">(</span><span class="n">filhoDir</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-16-19" name="__codelineno-16-19"></a><span class="w">        </span><span class="c1">//Após atualizar o valor dos nós filhos de &#39;i&#39;, atualiza-se o valor do nó &#39;i&#39;</span>
<a id="__codelineno-16-20" name="__codelineno-16-20"></a><span class="w">        </span><span class="n">st</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">funcao</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="n">filhoEsq</span><span class="p">(</span><span class="n">i</span><span class="p">)],</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="n">filhoDir</span><span class="p">(</span><span class="n">i</span><span class="p">)]);</span><span class="w"></span>
<a id="__codelineno-16-21" name="__codelineno-16-21"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-16-22" name="__codelineno-16-22"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<p>A próxima função a ser analisada/implementada é a <code>query</code>, responsável por fazer as consultas. Ao analisar o nó <span class="arithmatex">\(i\)</span>, responsável pelo intervalo <code>[tl, tr]</code>, como explicado na seção <a href="#atualizações">Atualizações</a>, existem três possibilidades. O código abaixo mostra uma implementação da função <code>query</code>, ela recebe como parâmetros informações sobre o nó/segmento atual (ou seja, o índice <span class="arithmatex">\(i\)</span> e os limites <span class="arithmatex">\(tl\)</span> e <span class="arithmatex">\(tr\)</span>) e também os limites da consulta, <span class="arithmatex">\(l\)</span> e <span class="arithmatex">\(r\)</span>. Para fazer uma consulta no intervalo <code>[l, r]</code>, a função deve ser chamada da seguinte forma: <code>query(0, 0, n - 1, l, r)</code>, onde <code>n</code> representa o número de elementos de <code>A</code>.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-17-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-17-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-17-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-17-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-17-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-17-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-17-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-17-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-17-10">10</a></span>
<span class="normal"><a href="#__codelineno-17-11">11</a></span>
<span class="normal"><a href="#__codelineno-17-12">12</a></span>
<span class="normal"><a href="#__codelineno-17-13">13</a></span>
<span class="normal"><a href="#__codelineno-17-14">14</a></span>
<span class="normal"><a href="#__codelineno-17-15">15</a></span>
<span class="normal"><a href="#__codelineno-17-16">16</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">r</span><span class="p">){</span><span class="w"></span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="w">    </span><span class="c1">//O nó i está fora do intervalo de interesse.</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="w">    </span><span class="c1">//Retorne o elemento neutro que não afeta a consulta.</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">tr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">tl</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// Elemento neutro da RSQ</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="w">    </span><span class="c1">// O nó i está completamente incluído no intervalo de interesse. </span>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="w">    </span><span class="c1">// Retorne a informação contida no nó.</span>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">tr</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-17-10" name="__codelineno-17-10"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>
<a id="__codelineno-17-11" name="__codelineno-17-11"></a>
<a id="__codelineno-17-12" name="__codelineno-17-12"></a><span class="w">    </span><span class="c1">// Se a execução chegou nesse ponto, significa que o nó i está parcialmente </span>
<a id="__codelineno-17-13" name="__codelineno-17-13"></a><span class="w">    </span><span class="c1">// contido no intervalo de interesse. Então, continua-se a procura nos nós filhos.</span>
<a id="__codelineno-17-14" name="__codelineno-17-14"></a><span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">tr</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tl</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-17-15" name="__codelineno-17-15"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">funcao</span><span class="p">(</span><span class="n">query</span><span class="p">(</span><span class="n">filhoEsq</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">),</span><span class="w"> </span><span class="n">query</span><span class="p">(</span><span class="n">filhoDir</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">));</span><span class="w"></span>
<a id="__codelineno-17-16" name="__codelineno-17-16"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<p>A função <code>update</code> é responsável por fazer atualizações no array <code>A</code> e, consequentemente, na SegTree. O código abaixo mostra uma implementação da função <code>update</code>, ela recebe como parâmetros informações sobre o nó/segmento atual (ou seja, o índice <span class="arithmatex">\(no\)</span> e os limites <span class="arithmatex">\(tl\)</span> e <span class="arithmatex">\(tr\)</span>), o índice <span class="arithmatex">\(i\)</span> que se deseja atualizar e o novo valor a ser armazenado na posição <span class="arithmatex">\(i\)</span>. Para fazer <code>A[i] = x</code>, a função deve ser chamada da seguinte forma: <code>update(0, 0, n - 1, i, x);</code>, onde <code>n</code> representa o número de elementos de <code>A</code>.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span>
<span class="normal"><a href="#__codelineno-18-11">11</a></span>
<span class="normal"><a href="#__codelineno-18-12">12</a></span>
<span class="normal"><a href="#__codelineno-18-13">13</a></span>
<span class="normal"><a href="#__codelineno-18-14">14</a></span>
<span class="normal"><a href="#__codelineno-18-15">15</a></span>
<span class="normal"><a href="#__codelineno-18-16">16</a></span>
<span class="normal"><a href="#__codelineno-18-17">17</a></span>
<span class="normal"><a href="#__codelineno-18-18">18</a></span>
<span class="normal"><a href="#__codelineno-18-19">19</a></span>
<span class="normal"><a href="#__codelineno-18-20">20</a></span>
<span class="normal"><a href="#__codelineno-18-21">21</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">no</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">novoValor</span><span class="p">){</span><span class="w"></span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="w">    </span><span class="c1">// Índice cujo valor deve ser atualizado</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">tr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w"></span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="w">        </span><span class="n">st</span><span class="p">[</span><span class="n">no</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">novoValor</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="w">        </span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">novoValor</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="w">    </span><span class="c1">// O intervalo não contem o índice a ser atualizado</span>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">tr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-18-11" name="__codelineno-18-11"></a><span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-18-12" name="__codelineno-18-12"></a>
<a id="__codelineno-18-13" name="__codelineno-18-13"></a><span class="w">    </span><span class="c1">// O intervalo contém o índice, mas deve-se chegar no nó específico. </span>
<a id="__codelineno-18-14" name="__codelineno-18-14"></a><span class="w">    </span><span class="c1">// O processo é repetido recursivamente nos filhos.</span>
<a id="__codelineno-18-15" name="__codelineno-18-15"></a><span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">tr</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tl</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-18-16" name="__codelineno-18-16"></a><span class="w">    </span><span class="n">update</span><span class="p">(</span><span class="n">filhoEsq</span><span class="p">(</span><span class="n">no</span><span class="p">),</span><span class="w">    </span><span class="n">tl</span><span class="p">,</span><span class="w">  </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">novoValor</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-18-17" name="__codelineno-18-17"></a><span class="w">    </span><span class="n">update</span><span class="p">(</span><span class="n">filhoDir</span><span class="p">(</span><span class="n">no</span><span class="p">),</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">novoValor</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-18-18" name="__codelineno-18-18"></a>
<a id="__codelineno-18-19" name="__codelineno-18-19"></a><span class="w">    </span><span class="c1">// Após atualizar os filhos (esquerdo ou direito), deve-se atualizar o valor do nó.</span>
<a id="__codelineno-18-20" name="__codelineno-18-20"></a><span class="w">    </span><span class="n">st</span><span class="p">[</span><span class="n">no</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">funcao</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="n">filhoEsq</span><span class="p">(</span><span class="n">no</span><span class="p">)],</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="n">filhoDir</span><span class="p">(</span><span class="n">no</span><span class="p">)]);</span><span class="w"></span>
<a id="__codelineno-18-21" name="__codelineno-18-21"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<p>O código abaixo mostra uma implementação completa de uma SegTree. Note que foi usado uma versão baseada em orientação à objetos, mas isso não é necessário.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">  1</a></span>
<span class="normal"><a href="#__codelineno-19-2">  2</a></span>
<span class="normal"><a href="#__codelineno-19-3">  3</a></span>
<span class="normal"><a href="#__codelineno-19-4">  4</a></span>
<span class="normal"><a href="#__codelineno-19-5">  5</a></span>
<span class="normal"><a href="#__codelineno-19-6">  6</a></span>
<span class="normal"><a href="#__codelineno-19-7">  7</a></span>
<span class="normal"><a href="#__codelineno-19-8">  8</a></span>
<span class="normal"><a href="#__codelineno-19-9">  9</a></span>
<span class="normal"><a href="#__codelineno-19-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-19-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-19-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-19-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-19-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-19-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-19-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-19-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-19-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-19-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-19-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-19-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-19-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-19-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-19-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-19-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-19-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-19-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-19-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-19-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-19-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-19-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-19-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-19-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-19-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-19-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-19-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-19-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-19-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-19-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-19-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-19-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-19-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-19-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-19-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-19-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-19-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-19-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-19-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-19-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-19-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-19-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-19-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-19-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-19-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-19-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-19-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-19-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-19-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-19-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-19-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-19-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-19-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-19-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-19-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-19-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-19-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-19-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-19-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-19-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-19-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-19-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-19-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-19-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-19-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-19-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-19-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-19-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-19-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-19-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-19-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-19-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-19-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-19-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-19-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-19-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-19-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-19-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-19-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-19-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-19-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-19-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-19-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-19-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-19-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-19-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-19-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-19-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-19-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-19-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-19-100">100</a></span>
<span class="normal"><a href="#__codelineno-19-101">101</a></span>
<span class="normal"><a href="#__codelineno-19-102">102</a></span>
<span class="normal"><a href="#__codelineno-19-103">103</a></span>
<span class="normal"><a href="#__codelineno-19-104">104</a></span>
<span class="normal"><a href="#__codelineno-19-105">105</a></span>
<span class="normal"><a href="#__codelineno-19-106">106</a></span>
<span class="normal"><a href="#__codelineno-19-107">107</a></span>
<span class="normal"><a href="#__codelineno-19-108">108</a></span>
<span class="normal"><a href="#__codelineno-19-109">109</a></span>
<span class="normal"><a href="#__codelineno-19-110">110</a></span>
<span class="normal"><a href="#__codelineno-19-111">111</a></span>
<span class="normal"><a href="#__codelineno-19-112">112</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;bits/stdc++.h&gt;</span><span class="cp"></span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="k">typedef</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w">  </span><span class="n">ll</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="k">typedef</span><span class="w"> </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span><span class="w"> </span><span class="n">vll</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a><span class="cp">#define filhoEsq(i) (2*(i) + 1)</span>
<a id="__codelineno-19-8" name="__codelineno-19-8"></a><span class="cp">#define filhoDir(i) (2*(i) + 2)</span>
<a id="__codelineno-19-9" name="__codelineno-19-9"></a>
<a id="__codelineno-19-10" name="__codelineno-19-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">SegTree</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-19-11" name="__codelineno-19-11"></a><span class="k">private</span><span class="o">:</span><span class="w"></span>
<a id="__codelineno-19-12" name="__codelineno-19-12"></a><span class="w">    </span><span class="n">vll</span><span class="w"> </span><span class="n">st</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-19-13" name="__codelineno-19-13"></a><span class="w">    </span><span class="n">ll</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-19-14" name="__codelineno-19-14"></a>
<a id="__codelineno-19-15" name="__codelineno-19-15"></a><span class="w">    </span><span class="n">ll</span><span class="w"> </span><span class="n">el_neutro</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-19-16" name="__codelineno-19-16"></a>
<a id="__codelineno-19-17" name="__codelineno-19-17"></a><span class="w">    </span><span class="n">ll</span><span class="w"> </span><span class="nf">funcao</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Função usada na SegTree: soma</span>
<a id="__codelineno-19-18" name="__codelineno-19-18"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-19-19" name="__codelineno-19-19"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-19-20" name="__codelineno-19-20"></a>
<a id="__codelineno-19-21" name="__codelineno-19-21"></a><span class="w">    </span><span class="n">ll</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">no</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">r</span><span class="p">){</span><span class="w"></span>
<a id="__codelineno-19-22" name="__codelineno-19-22"></a><span class="w">        </span><span class="c1">//O nó está fora do intervalo de interesse. </span>
<a id="__codelineno-19-23" name="__codelineno-19-23"></a><span class="w">        </span><span class="c1">//Retorne o elemento neutro que não afeta a consulta.</span>
<a id="__codelineno-19-24" name="__codelineno-19-24"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">tr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">tl</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-19-25" name="__codelineno-19-25"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">el_neutro</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-19-26" name="__codelineno-19-26"></a>
<a id="__codelineno-19-27" name="__codelineno-19-27"></a><span class="w">        </span><span class="c1">// O nó está completamente incluído no intervalo de interesse. </span>
<a id="__codelineno-19-28" name="__codelineno-19-28"></a><span class="w">        </span><span class="c1">// Retorne a informação contida no nó.</span>
<a id="__codelineno-19-29" name="__codelineno-19-29"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">tr</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-19-30" name="__codelineno-19-30"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="n">no</span><span class="p">];</span><span class="w"></span>
<a id="__codelineno-19-31" name="__codelineno-19-31"></a>
<a id="__codelineno-19-32" name="__codelineno-19-32"></a><span class="w">        </span><span class="c1">// Se chegarmos aqui, é porque esse nó está parcialmente contido no intervalo de interesse. </span>
<a id="__codelineno-19-33" name="__codelineno-19-33"></a><span class="w">        </span><span class="c1">// Então, continuamos procurando nos filhos.</span>
<a id="__codelineno-19-34" name="__codelineno-19-34"></a><span class="w">        </span><span class="n">ll</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">tr</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tl</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-19-35" name="__codelineno-19-35"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">funcao</span><span class="p">(</span><span class="n">query</span><span class="p">(</span><span class="n">filhoEsq</span><span class="p">(</span><span class="n">no</span><span class="p">),</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">),</span><span class="w"> </span><span class="n">query</span><span class="p">(</span><span class="n">filhoDir</span><span class="p">(</span><span class="n">no</span><span class="p">),</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">));</span><span class="w"></span>
<a id="__codelineno-19-36" name="__codelineno-19-36"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-19-37" name="__codelineno-19-37"></a>
<a id="__codelineno-19-38" name="__codelineno-19-38"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">no</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">novoValor</span><span class="p">){</span><span class="w"></span>
<a id="__codelineno-19-39" name="__codelineno-19-39"></a><span class="w">        </span><span class="c1">// Chegamos no índice que queremos atualizar o valor</span>
<a id="__codelineno-19-40" name="__codelineno-19-40"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">tr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">i</span><span class="p">){</span><span class="w"></span>
<a id="__codelineno-19-41" name="__codelineno-19-41"></a><span class="w">            </span><span class="n">st</span><span class="p">[</span><span class="n">no</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">novoValor</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-19-42" name="__codelineno-19-42"></a><span class="w">            </span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">novoValor</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-19-43" name="__codelineno-19-43"></a><span class="w">            </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-19-44" name="__codelineno-19-44"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-19-45" name="__codelineno-19-45"></a>
<a id="__codelineno-19-46" name="__codelineno-19-46"></a><span class="w">        </span><span class="c1">// O intervalo que estamos não contem o índice que queremos atualizar, retorne</span>
<a id="__codelineno-19-47" name="__codelineno-19-47"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">tr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-19-48" name="__codelineno-19-48"></a><span class="w">            </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-19-49" name="__codelineno-19-49"></a>
<a id="__codelineno-19-50" name="__codelineno-19-50"></a><span class="w">        </span><span class="c1">// O intervalo contém o índice, mas temos que chegar no nó específico. </span>
<a id="__codelineno-19-51" name="__codelineno-19-51"></a><span class="w">        </span><span class="c1">// Repetimos o processo recursivamente nos filhos.</span>
<a id="__codelineno-19-52" name="__codelineno-19-52"></a><span class="w">        </span><span class="n">ll</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">tr</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tl</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-19-53" name="__codelineno-19-53"></a><span class="w">        </span><span class="n">update</span><span class="p">(</span><span class="n">filhoEsq</span><span class="p">(</span><span class="n">no</span><span class="p">),</span><span class="w">    </span><span class="n">tl</span><span class="p">,</span><span class="w">  </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">novoValor</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-19-54" name="__codelineno-19-54"></a><span class="w">        </span><span class="n">update</span><span class="p">(</span><span class="n">filhoDir</span><span class="p">(</span><span class="n">no</span><span class="p">),</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">novoValor</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-19-55" name="__codelineno-19-55"></a>
<a id="__codelineno-19-56" name="__codelineno-19-56"></a><span class="w">        </span><span class="c1">// Após atualizar o filho (esquerdo ou direito), precisamos atualizar o valor do nó.</span>
<a id="__codelineno-19-57" name="__codelineno-19-57"></a><span class="w">        </span><span class="n">st</span><span class="p">[</span><span class="n">no</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">funcao</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="n">filhoEsq</span><span class="p">(</span><span class="n">no</span><span class="p">)],</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="n">filhoDir</span><span class="p">(</span><span class="n">no</span><span class="p">)]);</span><span class="w"></span>
<a id="__codelineno-19-58" name="__codelineno-19-58"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-19-59" name="__codelineno-19-59"></a>
<a id="__codelineno-19-60" name="__codelineno-19-60"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">no</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">R</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-19-61" name="__codelineno-19-61"></a><span class="w">        </span><span class="c1">//Chegamos no nó que deve conter o valor de A[L] ou A[R]</span>
<a id="__codelineno-19-62" name="__codelineno-19-62"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">L</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">R</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-19-63" name="__codelineno-19-63"></a><span class="w">            </span><span class="n">st</span><span class="p">[</span><span class="n">no</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">L</span><span class="p">];</span><span class="w"></span>
<a id="__codelineno-19-64" name="__codelineno-19-64"></a><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-19-65" name="__codelineno-19-65"></a><span class="w">            </span><span class="c1">//Recursivamente construimos a SegTree</span>
<a id="__codelineno-19-66" name="__codelineno-19-66"></a><span class="w">            </span><span class="n">ll</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">L</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">R</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">L</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-19-67" name="__codelineno-19-67"></a><span class="w">            </span><span class="n">build</span><span class="p">(</span><span class="n">filhoEsq</span><span class="p">(</span><span class="n">no</span><span class="p">),</span><span class="w">     </span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-19-68" name="__codelineno-19-68"></a><span class="w">            </span><span class="n">build</span><span class="p">(</span><span class="n">filhoDir</span><span class="p">(</span><span class="n">no</span><span class="p">),</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-19-69" name="__codelineno-19-69"></a><span class="w">            </span><span class="n">st</span><span class="p">[</span><span class="n">no</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">funcao</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="n">filhoEsq</span><span class="p">(</span><span class="n">no</span><span class="p">)],</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="n">filhoDir</span><span class="p">(</span><span class="n">no</span><span class="p">)]);</span><span class="w"></span>
<a id="__codelineno-19-70" name="__codelineno-19-70"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-19-71" name="__codelineno-19-71"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-19-72" name="__codelineno-19-72"></a>
<a id="__codelineno-19-73" name="__codelineno-19-73"></a><span class="k">public</span><span class="o">:</span><span class="w"></span>
<a id="__codelineno-19-74" name="__codelineno-19-74"></a><span class="w">    </span><span class="n">SegTree</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">st</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">n</span><span class="p">){}</span><span class="w"></span>
<a id="__codelineno-19-75" name="__codelineno-19-75"></a><span class="w">    </span><span class="n">SegTree</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">vll</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-19-76" name="__codelineno-19-76"></a><span class="w">        </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-19-77" name="__codelineno-19-77"></a><span class="w">        </span><span class="n">st</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-19-78" name="__codelineno-19-78"></a><span class="w">        </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"></span>
<a id="__codelineno-19-79" name="__codelineno-19-79"></a><span class="w">        </span><span class="n">build</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-19-80" name="__codelineno-19-80"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-19-81" name="__codelineno-19-81"></a><span class="w">    </span><span class="n">ll</span><span class="w"> </span><span class="n">query</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w">  </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-19-82" name="__codelineno-19-82"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-19-83" name="__codelineno-19-83"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-19-84" name="__codelineno-19-84"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">update</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">x</span><span class="p">){</span><span class="w"></span>
<a id="__codelineno-19-85" name="__codelineno-19-85"></a><span class="w">      </span><span class="n">update</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-19-86" name="__codelineno-19-86"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-19-87" name="__codelineno-19-87"></a><span class="p">};</span><span class="w"></span>
<a id="__codelineno-19-88" name="__codelineno-19-88"></a>
<a id="__codelineno-19-89" name="__codelineno-19-89"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-19-90" name="__codelineno-19-90"></a><span class="w">    </span><span class="c1">//       0  1  2  3  4  5  6  7  8</span>
<a id="__codelineno-19-91" name="__codelineno-19-91"></a><span class="w">    </span><span class="n">vll</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">};</span><span class="w"></span>
<a id="__codelineno-19-92" name="__codelineno-19-92"></a><span class="w">    </span><span class="n">SegTree</span><span class="w"> </span><span class="n">st</span><span class="p">(</span><span class="n">a</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-19-93" name="__codelineno-19-93"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">   </span><span class="c1">// 29</span>
<a id="__codelineno-19-94" name="__codelineno-19-94"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">   </span><span class="c1">// 0</span>
<a id="__codelineno-19-95" name="__codelineno-19-95"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">   </span><span class="c1">// 8</span>
<a id="__codelineno-19-96" name="__codelineno-19-96"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">   </span><span class="c1">// 27</span>
<a id="__codelineno-19-97" name="__codelineno-19-97"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">   </span><span class="c1">// 15</span>
<a id="__codelineno-19-98" name="__codelineno-19-98"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">   </span><span class="c1">// 7</span>
<a id="__codelineno-19-99" name="__codelineno-19-99"></a>
<a id="__codelineno-19-100" name="__codelineno-19-100"></a><span class="w">    </span><span class="n">st</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span><span class="w">                 </span><span class="c1">// A[0] = 10</span>
<a id="__codelineno-19-101" name="__codelineno-19-101"></a>
<a id="__codelineno-19-102" name="__codelineno-19-102"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">   </span><span class="c1">// 39</span>
<a id="__codelineno-19-103" name="__codelineno-19-103"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">   </span><span class="c1">// 10</span>
<a id="__codelineno-19-104" name="__codelineno-19-104"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">   </span><span class="c1">// 18</span>
<a id="__codelineno-19-105" name="__codelineno-19-105"></a>
<a id="__codelineno-19-106" name="__codelineno-19-106"></a><span class="w">    </span><span class="n">st</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">);</span><span class="w">                  </span><span class="c1">// A[8] = 7;</span>
<a id="__codelineno-19-107" name="__codelineno-19-107"></a>
<a id="__codelineno-19-108" name="__codelineno-19-108"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">   </span><span class="c1">// 9</span>
<a id="__codelineno-19-109" name="__codelineno-19-109"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">   </span><span class="c1">// 46</span>
<a id="__codelineno-19-110" name="__codelineno-19-110"></a>
<a id="__codelineno-19-111" name="__codelineno-19-111"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-19-112" name="__codelineno-19-112"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<h3 id="atualizacoes-em-intervalos-lazy-propagation">Atualizações em Intervalos (Lazy Propagation)</h3>
<p>Como visto, a função <code>update</code> atualiza apenas uma posição do array, mas em alguns casos é necessário alterar o valor de um intervalo do array, por exemplo, alterar os elementos da posição <span class="arithmatex">\(l\)</span> a <span class="arithmatex">\(r\)</span> para <span class="arithmatex">\(x\)</span>. Uma estratégia ingênua é chamar a função <code>update</code> para cada posição do array (complexidade <span class="arithmatex">\(O(n)\)</span>). Note que se for necessário alterar todos os elementos do array, uma alternativa é alterar apenas a raiz e postergar a atualização dos outros nós. Dessa forma, os nós filhos são atualizados somente quando for realmente necessário. Esse processo é conhecido como <strong>Lazy Propagation</strong>. É importante destacar que, para implementar <em>lazy propagation</em>, cada tipo de SegTree vai requerer uma implementação um pouco diferente, por isso, será importante entender como essa estratégia funciona.</p>
<p>Na SegTree com <em>Lazy Propagation</em>, cada segmento (nó) terá também um valor <strong>lazy</strong> associado. Uma atualização dividirá o segmento da mesma forma feita anteriormente e definirá o valor <code>lazy</code> em cada segmento alcançado. Assim, sempre que um nó for analisado, seja por meio de uma atualização ou uma consulta, uma função, <code>propagate</code>, será chamada. Essa função fica responsável por atualizar a informação no segmento atual e passar o valor <code>lazy</code> para seus filhos.</p>
<p>Considere o problema de saber a soma dos elementos de um intervalo e que uma atualização de intervalo significa alterar o valor de todos os elementos do intervalo para um determinado valor. Para isso é necessário, além do vetor que armazena a SegTree, outros dois vetores: <code>lazy</code> e <code>marked</code>. O vetor <code>lazy</code> fica responsável por armazenar o valor do segmento que ainda não foi propagado para os nós filhos. Já o vetor <code>marked</code> (vetor booleano) indica se há uma atualização para ser feita no nó.</p>
<p>A função de propagação (<code>propagate</code>) é a função que atualiza o valor de um nó e posterga a atualização para os filhos. Essa função deve ser chamada toda vez que um nó for analisado (seja por uma atualização ou uma consulta). O código abaixo ilustra essa função.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span>
<span class="normal"><a href="#__codelineno-20-11">11</a></span>
<span class="normal"><a href="#__codelineno-20-12">12</a></span>
<span class="normal"><a href="#__codelineno-20-13">13</a></span>
<span class="normal"><a href="#__codelineno-20-14">14</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">propagate</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">R</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (1)</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="w">    </span><span class="c1">// Verifica se o nó precisa ser atualizado</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">marked</span><span class="p">[</span><span class="n">p</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="w">        </span><span class="c1">// O valor do nó será: número de elementos que esse intervalo representa vezes o novo valor de cada elemento do intervalo</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="w">        </span><span class="n">st</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">R</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">L</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">lazy</span><span class="p">[</span><span class="n">p</span><span class="p">];</span><span class="w"></span>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="w">        </span><span class="c1">// Se o nó não for uma folha, propague a atualização para os filhos.</span>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">L</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">R</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="w">            </span><span class="n">lazy</span><span class="p">[</span><span class="n">filhoDir</span><span class="p">(</span><span class="n">p</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lazy</span><span class="p">[</span><span class="n">filhoEsq</span><span class="p">(</span><span class="n">p</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lazy</span><span class="p">[</span><span class="n">p</span><span class="p">];</span><span class="w"></span>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="w">            </span><span class="n">marked</span><span class="p">[</span><span class="n">filhoDir</span><span class="p">(</span><span class="n">p</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">marked</span><span class="p">[</span><span class="n">filhoEsq</span><span class="p">(</span><span class="n">p</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="w">        </span><span class="c1">// Não é mais necessário atualizar esse nó</span>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="w">        </span><span class="n">marked</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-20-13" name="__codelineno-20-13"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-20-14" name="__codelineno-20-14"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<ol>
<li>Parâmetros:<ul>
<li><code>p</code>: nó atual</li>
<li><code>L</code>: limite inferior do intervalo que <code>p</code> representa (inclusivo)</li>
<li><code>R</code>: limite superior do intervalo que <code>p</code> representa (inclusivo)</li>
</ul>
</li>
</ol>
<p>A função abaixo altera o valor dos elementos do intervalo <code>[l, r]</code> para <code>novoValor</code>.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-21-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-21-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-21-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-21-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-21-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-21-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-21-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-21-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-21-10">10</a></span>
<span class="normal"><a href="#__codelineno-21-11">11</a></span>
<span class="normal"><a href="#__codelineno-21-12">12</a></span>
<span class="normal"><a href="#__codelineno-21-13">13</a></span>
<span class="normal"><a href="#__codelineno-21-14">14</a></span>
<span class="normal"><a href="#__codelineno-21-15">15</a></span>
<span class="normal"><a href="#__codelineno-21-16">16</a></span>
<span class="normal"><a href="#__codelineno-21-17">17</a></span>
<span class="normal"><a href="#__codelineno-21-18">18</a></span>
<span class="normal"><a href="#__codelineno-21-19">19</a></span>
<span class="normal"><a href="#__codelineno-21-20">20</a></span>
<span class="normal"><a href="#__codelineno-21-21">21</a></span>
<span class="normal"><a href="#__codelineno-21-22">22</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">no</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">novoValor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (1)</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="w">    </span><span class="c1">// Chegamos no índice que queremos atualizar o valor</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">tr</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="w">        </span><span class="n">lazy</span><span class="p">[</span><span class="n">no</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">novoValor</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="w">        </span><span class="n">marked</span><span class="p">[</span><span class="n">no</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="w">        </span><span class="n">propagate</span><span class="p">(</span><span class="n">no</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-21-7" name="__codelineno-21-7"></a><span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-21-8" name="__codelineno-21-8"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-21-9" name="__codelineno-21-9"></a>
<a id="__codelineno-21-10" name="__codelineno-21-10"></a><span class="w">    </span><span class="c1">// O intervalo que estamos não contem o índice que queremos atualizar, retorne</span>
<a id="__codelineno-21-11" name="__codelineno-21-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">tr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">l</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-21-12" name="__codelineno-21-12"></a><span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-21-13" name="__codelineno-21-13"></a>
<a id="__codelineno-21-14" name="__codelineno-21-14"></a><span class="w">    </span><span class="c1">// O intervalo contém o índice, mas temos que chegar no nó específico. </span>
<a id="__codelineno-21-15" name="__codelineno-21-15"></a><span class="w">    </span><span class="c1">// Repetimos o processo recursivamente nos filhos.</span>
<a id="__codelineno-21-16" name="__codelineno-21-16"></a><span class="w">    </span><span class="n">ll</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">tr</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tl</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-21-17" name="__codelineno-21-17"></a><span class="w">    </span><span class="n">update</span><span class="p">(</span><span class="n">filhoEsq</span><span class="p">(</span><span class="n">no</span><span class="p">),</span><span class="w">    </span><span class="n">tl</span><span class="p">,</span><span class="w">  </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">novoValor</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-21-18" name="__codelineno-21-18"></a><span class="w">    </span><span class="n">update</span><span class="p">(</span><span class="n">filhoDir</span><span class="p">(</span><span class="n">no</span><span class="p">),</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">novoValor</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-21-19" name="__codelineno-21-19"></a>
<a id="__codelineno-21-20" name="__codelineno-21-20"></a><span class="w">    </span><span class="c1">// Após atualizar o filho (esquerdo ou direito), precisamos atualizar o valor do nó.</span>
<a id="__codelineno-21-21" name="__codelineno-21-21"></a><span class="w">    </span><span class="n">st</span><span class="p">[</span><span class="n">no</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">funcao</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="n">filhoEsq</span><span class="p">(</span><span class="n">no</span><span class="p">)],</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="n">filhoDir</span><span class="p">(</span><span class="n">no</span><span class="p">)]);</span><span class="w"></span>
<a id="__codelineno-21-22" name="__codelineno-21-22"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<ol>
<li>Parâmetros:<ul>
<li><code>no</code>: nó atual</li>
<li><code>tl</code>: limite inferior do intervalo que <code>no</code> representa (inclusivo)</li>
<li><code>tr</code>: limite superior do intervalo que <code>no</code> representa (inclusivo)</li>
<li><code>l</code>: limite inferior do intervalo que se deseja atualizar no vetor</li>
<li><code>r</code>: limite superior do intervalo que se deseja atualizar no vetor</li>
<li><code>novoValor</code>:  novo valor dos elementos no intervalo</li>
</ul>
</li>
</ol>
<p>Versão final da classe SegTree com alguns exemplos de utilização:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1">  1</a></span>
<span class="normal"><a href="#__codelineno-22-2">  2</a></span>
<span class="normal"><a href="#__codelineno-22-3">  3</a></span>
<span class="normal"><a href="#__codelineno-22-4">  4</a></span>
<span class="normal"><a href="#__codelineno-22-5">  5</a></span>
<span class="normal"><a href="#__codelineno-22-6">  6</a></span>
<span class="normal"><a href="#__codelineno-22-7">  7</a></span>
<span class="normal"><a href="#__codelineno-22-8">  8</a></span>
<span class="normal"><a href="#__codelineno-22-9">  9</a></span>
<span class="normal"><a href="#__codelineno-22-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-22-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-22-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-22-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-22-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-22-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-22-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-22-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-22-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-22-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-22-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-22-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-22-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-22-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-22-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-22-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-22-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-22-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-22-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-22-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-22-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-22-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-22-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-22-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-22-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-22-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-22-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-22-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-22-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-22-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-22-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-22-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-22-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-22-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-22-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-22-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-22-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-22-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-22-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-22-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-22-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-22-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-22-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-22-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-22-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-22-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-22-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-22-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-22-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-22-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-22-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-22-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-22-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-22-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-22-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-22-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-22-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-22-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-22-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-22-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-22-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-22-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-22-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-22-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-22-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-22-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-22-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-22-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-22-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-22-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-22-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-22-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-22-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-22-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-22-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-22-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-22-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-22-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-22-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-22-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-22-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-22-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-22-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-22-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-22-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-22-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-22-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-22-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-22-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-22-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-22-100">100</a></span>
<span class="normal"><a href="#__codelineno-22-101">101</a></span>
<span class="normal"><a href="#__codelineno-22-102">102</a></span>
<span class="normal"><a href="#__codelineno-22-103">103</a></span>
<span class="normal"><a href="#__codelineno-22-104">104</a></span>
<span class="normal"><a href="#__codelineno-22-105">105</a></span>
<span class="normal"><a href="#__codelineno-22-106">106</a></span>
<span class="normal"><a href="#__codelineno-22-107">107</a></span>
<span class="normal"><a href="#__codelineno-22-108">108</a></span>
<span class="normal"><a href="#__codelineno-22-109">109</a></span>
<span class="normal"><a href="#__codelineno-22-110">110</a></span>
<span class="normal"><a href="#__codelineno-22-111">111</a></span>
<span class="normal"><a href="#__codelineno-22-112">112</a></span>
<span class="normal"><a href="#__codelineno-22-113">113</a></span>
<span class="normal"><a href="#__codelineno-22-114">114</a></span>
<span class="normal"><a href="#__codelineno-22-115">115</a></span>
<span class="normal"><a href="#__codelineno-22-116">116</a></span>
<span class="normal"><a href="#__codelineno-22-117">117</a></span>
<span class="normal"><a href="#__codelineno-22-118">118</a></span>
<span class="normal"><a href="#__codelineno-22-119">119</a></span>
<span class="normal"><a href="#__codelineno-22-120">120</a></span>
<span class="normal"><a href="#__codelineno-22-121">121</a></span>
<span class="normal"><a href="#__codelineno-22-122">122</a></span>
<span class="normal"><a href="#__codelineno-22-123">123</a></span>
<span class="normal"><a href="#__codelineno-22-124">124</a></span>
<span class="normal"><a href="#__codelineno-22-125">125</a></span>
<span class="normal"><a href="#__codelineno-22-126">126</a></span>
<span class="normal"><a href="#__codelineno-22-127">127</a></span>
<span class="normal"><a href="#__codelineno-22-128">128</a></span>
<span class="normal"><a href="#__codelineno-22-129">129</a></span>
<span class="normal"><a href="#__codelineno-22-130">130</a></span>
<span class="normal"><a href="#__codelineno-22-131">131</a></span>
<span class="normal"><a href="#__codelineno-22-132">132</a></span>
<span class="normal"><a href="#__codelineno-22-133">133</a></span>
<span class="normal"><a href="#__codelineno-22-134">134</a></span>
<span class="normal"><a href="#__codelineno-22-135">135</a></span>
<span class="normal"><a href="#__codelineno-22-136">136</a></span>
<span class="normal"><a href="#__codelineno-22-137">137</a></span>
<span class="normal"><a href="#__codelineno-22-138">138</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;bits/stdc++.h&gt;</span><span class="cp"></span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="k">typedef</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w">  </span><span class="n">ll</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="k">typedef</span><span class="w"> </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span><span class="w"> </span><span class="n">vll</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="cp">#define filhoEsq(i) (2*(i) + 1)</span>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="cp">#define filhoDir(i) (2*(i) + 2)</span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">SegTree</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-22-11" name="__codelineno-22-11"></a><span class="k">private</span><span class="o">:</span><span class="w"></span>
<a id="__codelineno-22-12" name="__codelineno-22-12"></a><span class="w">    </span><span class="n">vll</span><span class="w"> </span><span class="n">st</span><span class="p">,</span><span class="w"> </span><span class="n">lazy</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-22-13" name="__codelineno-22-13"></a><span class="w">    </span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="w"> </span><span class="n">marked</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-22-14" name="__codelineno-22-14"></a><span class="w">    </span><span class="n">ll</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-22-15" name="__codelineno-22-15"></a>
<a id="__codelineno-22-16" name="__codelineno-22-16"></a><span class="w">    </span><span class="n">ll</span><span class="w"> </span><span class="nf">funcao</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Função usada na SegTree: soma</span>
<a id="__codelineno-22-17" name="__codelineno-22-17"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-22-18" name="__codelineno-22-18"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-22-19" name="__codelineno-22-19"></a>
<a id="__codelineno-22-20" name="__codelineno-22-20"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">propagate</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">R</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-22-21" name="__codelineno-22-21"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">marked</span><span class="p">[</span><span class="n">p</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-22-22" name="__codelineno-22-22"></a><span class="w">            </span><span class="c1">// O valor do nó será: número de elementos que esse intervalo representa vezes o novo valor de cada elemento do intervalo</span>
<a id="__codelineno-22-23" name="__codelineno-22-23"></a><span class="w">            </span><span class="n">st</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lazy</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">R</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">L</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-22-24" name="__codelineno-22-24"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">L</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">R</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-22-25" name="__codelineno-22-25"></a><span class="w">                </span><span class="n">lazy</span><span class="p">[</span><span class="n">filhoDir</span><span class="p">(</span><span class="n">p</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lazy</span><span class="p">[</span><span class="n">filhoEsq</span><span class="p">(</span><span class="n">p</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lazy</span><span class="p">[</span><span class="n">p</span><span class="p">];</span><span class="w"></span>
<a id="__codelineno-22-26" name="__codelineno-22-26"></a><span class="w">                </span><span class="n">marked</span><span class="p">[</span><span class="n">filhoDir</span><span class="p">(</span><span class="n">p</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">marked</span><span class="p">[</span><span class="n">filhoEsq</span><span class="p">(</span><span class="n">p</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-22-27" name="__codelineno-22-27"></a><span class="w">            </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-22-28" name="__codelineno-22-28"></a><span class="w">            </span><span class="n">marked</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-22-29" name="__codelineno-22-29"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-22-30" name="__codelineno-22-30"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-22-31" name="__codelineno-22-31"></a>
<a id="__codelineno-22-32" name="__codelineno-22-32"></a><span class="w">    </span><span class="n">ll</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">no</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">r</span><span class="p">){</span><span class="w"></span>
<a id="__codelineno-22-33" name="__codelineno-22-33"></a><span class="w">        </span><span class="c1">//Precisamos propagar a possível atualização do nó</span>
<a id="__codelineno-22-34" name="__codelineno-22-34"></a><span class="w">        </span><span class="n">propagate</span><span class="p">(</span><span class="n">no</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-22-35" name="__codelineno-22-35"></a>
<a id="__codelineno-22-36" name="__codelineno-22-36"></a><span class="w">        </span><span class="c1">//O nó está fora do intervalo de interesse. Retorne o elemento neutro que não afeta a consulta.</span>
<a id="__codelineno-22-37" name="__codelineno-22-37"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">tr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">tl</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-22-38" name="__codelineno-22-38"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-22-39" name="__codelineno-22-39"></a>
<a id="__codelineno-22-40" name="__codelineno-22-40"></a><span class="w">        </span><span class="c1">// O nó está completamente incluído no intervalo de interesse. Retorne a informação contida no nó.</span>
<a id="__codelineno-22-41" name="__codelineno-22-41"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">tr</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-22-42" name="__codelineno-22-42"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="n">no</span><span class="p">];</span><span class="w"></span>
<a id="__codelineno-22-43" name="__codelineno-22-43"></a>
<a id="__codelineno-22-44" name="__codelineno-22-44"></a><span class="w">        </span><span class="c1">// Se chegarmos aqui, é porque esse nó está parcialmente contido no intervalo de interesse. Então, continuamos procurando nos filhos.</span>
<a id="__codelineno-22-45" name="__codelineno-22-45"></a><span class="w">        </span><span class="n">ll</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">tr</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tl</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-22-46" name="__codelineno-22-46"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">funcao</span><span class="p">(</span><span class="n">query</span><span class="p">(</span><span class="n">filhoEsq</span><span class="p">(</span><span class="n">no</span><span class="p">),</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">),</span><span class="w"> </span><span class="n">query</span><span class="p">(</span><span class="n">filhoDir</span><span class="p">(</span><span class="n">no</span><span class="p">),</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">));</span><span class="w"></span>
<a id="__codelineno-22-47" name="__codelineno-22-47"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-22-48" name="__codelineno-22-48"></a>
<a id="__codelineno-22-49" name="__codelineno-22-49"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">no</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">novoValor</span><span class="p">){</span><span class="w"></span>
<a id="__codelineno-22-50" name="__codelineno-22-50"></a><span class="w">        </span><span class="c1">//Precisamos propagar a possível atualização do nó</span>
<a id="__codelineno-22-51" name="__codelineno-22-51"></a><span class="w">        </span><span class="n">propagate</span><span class="p">(</span><span class="n">no</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-22-52" name="__codelineno-22-52"></a>
<a id="__codelineno-22-53" name="__codelineno-22-53"></a><span class="w">        </span><span class="c1">// Chegamos no índice que queremos atualizar o valor</span>
<a id="__codelineno-22-54" name="__codelineno-22-54"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">tr</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-22-55" name="__codelineno-22-55"></a><span class="w">            </span><span class="n">lazy</span><span class="p">[</span><span class="n">no</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">novoValor</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-22-56" name="__codelineno-22-56"></a><span class="w">            </span><span class="n">marked</span><span class="p">[</span><span class="n">no</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-22-57" name="__codelineno-22-57"></a><span class="w">            </span><span class="n">propagate</span><span class="p">(</span><span class="n">no</span><span class="p">,</span><span class="w"> </span><span class="n">tl</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-22-58" name="__codelineno-22-58"></a><span class="w">            </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-22-59" name="__codelineno-22-59"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-22-60" name="__codelineno-22-60"></a>
<a id="__codelineno-22-61" name="__codelineno-22-61"></a><span class="w">        </span><span class="c1">// O intervalo que estamos não contem o índice que queremos atualizar, retorne</span>
<a id="__codelineno-22-62" name="__codelineno-22-62"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tl</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">tr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">l</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-22-63" name="__codelineno-22-63"></a><span class="w">            </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-22-64" name="__codelineno-22-64"></a>
<a id="__codelineno-22-65" name="__codelineno-22-65"></a><span class="w">        </span><span class="c1">// O intervalo contém o índice, mas temos que chegar no nó específico. Repetimos o processo recursivamente nos filhos.</span>
<a id="__codelineno-22-66" name="__codelineno-22-66"></a><span class="w">        </span><span class="n">ll</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">tr</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tl</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-22-67" name="__codelineno-22-67"></a><span class="w">        </span><span class="n">update</span><span class="p">(</span><span class="n">filhoEsq</span><span class="p">(</span><span class="n">no</span><span class="p">),</span><span class="w">    </span><span class="n">tl</span><span class="p">,</span><span class="w">  </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">novoValor</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-22-68" name="__codelineno-22-68"></a><span class="w">        </span><span class="n">update</span><span class="p">(</span><span class="n">filhoDir</span><span class="p">(</span><span class="n">no</span><span class="p">),</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tr</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">novoValor</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-22-69" name="__codelineno-22-69"></a>
<a id="__codelineno-22-70" name="__codelineno-22-70"></a><span class="w">        </span><span class="c1">// Após atualizar o filho (esquerdo ou direito), precisamos atualizar o valor do nó.</span>
<a id="__codelineno-22-71" name="__codelineno-22-71"></a><span class="w">        </span><span class="n">st</span><span class="p">[</span><span class="n">no</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">funcao</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="n">filhoEsq</span><span class="p">(</span><span class="n">no</span><span class="p">)],</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="n">filhoDir</span><span class="p">(</span><span class="n">no</span><span class="p">)]);</span><span class="w"></span>
<a id="__codelineno-22-72" name="__codelineno-22-72"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-22-73" name="__codelineno-22-73"></a>
<a id="__codelineno-22-74" name="__codelineno-22-74"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">no</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">R</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">vll</span><span class="w"> </span><span class="o">&amp;</span><span class="n">A</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-22-75" name="__codelineno-22-75"></a><span class="w">     </span><span class="c1">//Chegamos no nó que deve conter o valor de A[L] ou A[R]</span>
<a id="__codelineno-22-76" name="__codelineno-22-76"></a><span class="w">     </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">L</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">R</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-22-77" name="__codelineno-22-77"></a><span class="w">      </span><span class="n">st</span><span class="p">[</span><span class="n">no</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">L</span><span class="p">];</span><span class="w"></span>
<a id="__codelineno-22-78" name="__codelineno-22-78"></a><span class="w">     </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-22-79" name="__codelineno-22-79"></a><span class="w">      </span><span class="c1">//Recursivamente construimos a SegTree</span>
<a id="__codelineno-22-80" name="__codelineno-22-80"></a><span class="w">      </span><span class="n">ll</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">L</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">R</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">L</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-22-81" name="__codelineno-22-81"></a><span class="w">      </span><span class="n">build</span><span class="p">(</span><span class="n">filhoEsq</span><span class="p">(</span><span class="n">no</span><span class="p">),</span><span class="w">     </span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-22-82" name="__codelineno-22-82"></a><span class="w">      </span><span class="n">build</span><span class="p">(</span><span class="n">filhoDir</span><span class="p">(</span><span class="n">no</span><span class="p">),</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-22-83" name="__codelineno-22-83"></a><span class="w">      </span><span class="n">st</span><span class="p">[</span><span class="n">no</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">funcao</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="n">filhoEsq</span><span class="p">(</span><span class="n">no</span><span class="p">)],</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="n">filhoDir</span><span class="p">(</span><span class="n">no</span><span class="p">)]);</span><span class="w"></span>
<a id="__codelineno-22-84" name="__codelineno-22-84"></a><span class="w">     </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-22-85" name="__codelineno-22-85"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-22-86" name="__codelineno-22-86"></a>
<a id="__codelineno-22-87" name="__codelineno-22-87"></a><span class="k">public</span><span class="o">:</span><span class="w"></span>
<a id="__codelineno-22-88" name="__codelineno-22-88"></a><span class="w">    </span><span class="n">SegTree</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">st</span><span class="p">(</span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">lazy</span><span class="p">(</span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">marked</span><span class="p">(</span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">),</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<a id="__codelineno-22-89" name="__codelineno-22-89"></a><span class="w">    </span><span class="n">SegTree</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">vll</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-22-90" name="__codelineno-22-90"></a><span class="w">        </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"></span>
<a id="__codelineno-22-91" name="__codelineno-22-91"></a><span class="w">        </span><span class="n">st</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-22-92" name="__codelineno-22-92"></a><span class="w">        </span><span class="n">lazy</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-22-93" name="__codelineno-22-93"></a><span class="w">        </span><span class="n">marked</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-22-94" name="__codelineno-22-94"></a><span class="w">        </span><span class="n">build</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-22-95" name="__codelineno-22-95"></a><span class="w"> </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-22-96" name="__codelineno-22-96"></a><span class="w">    </span><span class="n">ll</span><span class="w"> </span><span class="n">query</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w">  </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-22-97" name="__codelineno-22-97"></a><span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="n">query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-22-98" name="__codelineno-22-98"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-22-99" name="__codelineno-22-99"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">update</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">x</span><span class="p">){</span><span class="w"></span>
<a id="__codelineno-22-100" name="__codelineno-22-100"></a><span class="w">     </span><span class="n">update</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-22-101" name="__codelineno-22-101"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-22-102" name="__codelineno-22-102"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">update</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">x</span><span class="p">){</span><span class="w"></span>
<a id="__codelineno-22-103" name="__codelineno-22-103"></a><span class="w">     </span><span class="n">update</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-22-104" name="__codelineno-22-104"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-22-105" name="__codelineno-22-105"></a><span class="p">};</span><span class="w"></span>
<a id="__codelineno-22-106" name="__codelineno-22-106"></a>
<a id="__codelineno-22-107" name="__codelineno-22-107"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-22-108" name="__codelineno-22-108"></a><span class="w">    </span><span class="n">SegTree</span><span class="w"> </span><span class="n">st</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-22-109" name="__codelineno-22-109"></a><span class="w">    </span><span class="n">st</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-22-110" name="__codelineno-22-110"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">   </span><span class="c1">// 5</span>
<a id="__codelineno-22-111" name="__codelineno-22-111"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">   </span><span class="c1">// 0</span>
<a id="__codelineno-22-112" name="__codelineno-22-112"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">   </span><span class="c1">// 5</span>
<a id="__codelineno-22-113" name="__codelineno-22-113"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">   </span><span class="c1">// 1</span>
<a id="__codelineno-22-114" name="__codelineno-22-114"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">   </span><span class="c1">// 0</span>
<a id="__codelineno-22-115" name="__codelineno-22-115"></a>
<a id="__codelineno-22-116" name="__codelineno-22-116"></a><span class="w">    </span><span class="n">st</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-22-117" name="__codelineno-22-117"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// 5</span>
<a id="__codelineno-22-118" name="__codelineno-22-118"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// 10</span>
<a id="__codelineno-22-119" name="__codelineno-22-119"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// 15</span>
<a id="__codelineno-22-120" name="__codelineno-22-120"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1</span>
<a id="__codelineno-22-121" name="__codelineno-22-121"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// 2</span>
<a id="__codelineno-22-122" name="__codelineno-22-122"></a>
<a id="__codelineno-22-123" name="__codelineno-22-123"></a><span class="w">    </span><span class="n">st</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-22-124" name="__codelineno-22-124"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// 5</span>
<a id="__codelineno-22-125" name="__codelineno-22-125"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// 5</span>
<a id="__codelineno-22-126" name="__codelineno-22-126"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// 10</span>
<a id="__codelineno-22-127" name="__codelineno-22-127"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1</span>
<a id="__codelineno-22-128" name="__codelineno-22-128"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1</span>
<a id="__codelineno-22-129" name="__codelineno-22-129"></a>
<a id="__codelineno-22-130" name="__codelineno-22-130"></a><span class="w">    </span><span class="n">st</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-22-131" name="__codelineno-22-131"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// 5</span>
<a id="__codelineno-22-132" name="__codelineno-22-132"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// 24</span>
<a id="__codelineno-22-133" name="__codelineno-22-133"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// 29</span>
<a id="__codelineno-22-134" name="__codelineno-22-134"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1</span>
<a id="__codelineno-22-135" name="__codelineno-22-135"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// 20</span>
<a id="__codelineno-22-136" name="__codelineno-22-136"></a>
<a id="__codelineno-22-137" name="__codelineno-22-137"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-22-138" name="__codelineno-22-138"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<h3 id="material-complementar_1">Material complementar</h3>
<ul>
<li>⭐️ <a href="https://codeforces.com/edu/course/2/lesson/4">Segment Tree, part 1 (ITMO Academy)</a> 🤯</li>
<li>⭐️ <a href="https://codeforces.com/edu/course/2/lesson/5">Segment Tree, part 2 (ITMO Academy)</a> 🤯</li>
<li>⭐️ <a href="https://cp-algorithms.com/data_structures/segment_tree.html">Segment Tree</a></li>
<li>⭐️ <a href="https://noic.com.br/informatica/curso-noic/data-structures-04/">Segment Tree (Árvore de Segmentos)</a></li>
<li>⭐️ <a href="https://noic.com.br/materiais-informatica/curso/data-structures-05/">Segment Tree com Lazy Propagation</a></li>
<li><a href="https://csacademy.com/lesson/segment_trees/">Segment Tree (CS Academy)</a></li>
<li><a href="https://github.com/UnBalloon/programacao-competitiva/tree/master/Segment%20Trees%20(%C3%81rvores%20de%20segmento)">Segment Trees</a></li>
<li><a href="https://visualgo.net/en/segmenttree">Segment Tree - VisuAlgo</a></li>
<li><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg></span> <a href="https://www.youtube.com/watch?v=xztU7lmDLv8">Segment Tree Data Structure - Min Max Queries</a></li>
</ul>
<h2 id="disjoint-set-union-dsu">Disjoint Set Union (DSU)</h2>
<p>Para entender DSU, considere o seguinte problema (extraído desse <a href="https://csacademy.com/lesson/disjoint_data_sets/">link</a>): suponha que exista um grupo de <span class="arithmatex">\(N\)</span> amigos em um jogo. Inicialmente, cada um deles joga contra todos os outros. Conforme o jogo avança, alianças são formadas entre eles. A relação de aliança é transitiva, o que significa que se <span class="arithmatex">\(A\)</span> e <span class="arithmatex">\(B\)</span> são aliados e <span class="arithmatex">\(B\)</span> e <span class="arithmatex">\(C\)</span> são aliados, então <span class="arithmatex">\(A\)</span> e <span class="arithmatex">\(C\)</span> também são aliados. Você sabe quando as alianças são formadas. Em certos momentos você precisa saber se dois amigos em particular estão no mesmo time ou não.</p>
<p>Uma estratégia natural seria construir um grafo e, a cada atualização, incluir uma nova aresta ligando dois vertices do grafo. Para cada consulta pode-se realizar um percurso no grafo (usando <a href="https://cp-algorithms.com/graph/breadth-first-search.html">Busca em Largura</a> ou <a href="https://cp-algorithms.com/graph/depth-first-search.html">Busca em Profundidade</a>) começando no nó <span class="arithmatex">\(A\)</span> e verificando se o nó <span class="arithmatex">\(B\)</span> é visitado. Adicionar uma aresta é muito rápido, mas as consultas são lentas. Uma estratégia mais eficiente para resolver esse problema é usar <strong>Disjoint Set Union</strong>.</p>
<p>Um <strong>conjunto disjunto</strong>, também chamado <strong>union-find</strong>, é uma estrutura de dados que opera com um conjunto particionado em vários subconjuntos disjuntos. As duas principais operações dessa estrutura são:</p>
<ul>
<li><code>find</code>: Dado um elemento particular do conjunto, a função identifica o subconjunto do elemento. Para isso, a função retorna o representante do conjunto.</li>
<li><code>join</code>: Une dois subconjuntos em um único subconjunto.</li>
</ul>
<p>Um conjunto disjunto funciona representando cada componente conectado como uma árvore, onde a raiz de cada árvore é o representante do componente. O pai de cada nó é outro nó no mesmo componente. Considere o exemplo dos amigos jogando para ver como a estrutura funciona. Suponha que existam 6 amigos jogando. Inicialmente, não há alianças, então cada nó é a raiz de uma árvore (os amigos são numerados de 0 a 5):</p>
<figure>
<p><svg width="350px" height="60px" style="margin: 1.5em auto; display: block; height: 60px; width: 350px;"><g width="350" height="60" style="margin: 1.5em auto; display: block;"><g></g><g><g fixed="false" style="cursor: pointer;"><circle stroke-width="2" fill="white" stroke="black" r="18" cx="30" cy="30"></circle><text font-size="14" dy=".35em" text-anchor="middle" stroke-width="1" fill="black" stroke="black" x="30" y="30" style="user-select: none;">0</text></g><g fixed="false" style="cursor: pointer;"><circle stroke-width="2" fill="white" stroke="black" r="18" cx="90" cy="30"></circle><text font-size="14" dy=".35em" text-anchor="middle" stroke-width="1" fill="black" stroke="black" x="90" y="30" style="user-select: none;">1</text></g><g fixed="false" style="cursor: pointer;"><circle stroke-width="2" fill="white" stroke="black" r="18" cx="150" cy="30"></circle><text font-size="14" dy=".35em" text-anchor="middle" stroke-width="1" fill="black" stroke="black" x="150" y="30" style="user-select: none;">2</text></g><g fixed="false" style="cursor: pointer;"><circle stroke-width="2" fill="white" stroke="black" r="18" cx="210" cy="30"></circle><text font-size="14" dy=".35em" text-anchor="middle" stroke-width="1" fill="black" stroke="black" x="210" y="30" style="user-select: none;">3</text></g><g fixed="false" style="cursor: pointer;"><circle stroke-width="2" fill="white" stroke="black" r="18" cx="270" cy="30"></circle><text font-size="14" dy=".35em" text-anchor="middle" stroke-width="1" fill="black" stroke="black" x="270" y="30" style="user-select: none;">4</text></g><g fixed="false" style="cursor: pointer;"><circle stroke-width="2" fill="white" stroke="black" r="18" cx="330" cy="30"></circle><text font-size="14" dy=".35em" text-anchor="middle" stroke-width="1" fill="black" stroke="black" x="330" y="30" style="user-select: none;">5</text></g></g></g></svg></p>
<figcaption style="font-size=8pt">Fonte: <a href="https://csacademy.com/lesson/disjoint_data_sets/">Disjoint-set Data Structures</a></figcaption>
</figure>
<p>Em seguida, suponha que 1 e 3 se tornem aliados. Considere que o nó 1 seja escolhido como representante:</p>
<figure>
<p><svg width="300px" height="140px" style="margin: 1.5em auto; display: block; height: 140px; width: 300px;"><g width="300" height="140" style="margin: 1.5em auto; display: block;"><g><g><path d="M 90 120 L 90 30" fill="none" stroke-width="2" stroke="black"></path><path d="M 90 120 L 90 30" opacity="0" fill="none" stroke-width="30" stroke="black"></path><path stroke="black" fill="black" d="M -15 7.5 L 0 0 L -15 -7.5 Z" transform="translate (90 48.099998474121094) rotate(270)"></path></g></g><g><g fixed="false" style="cursor: pointer;"><circle stroke-width="2" fill="white" stroke="black" r="18" cx="30" cy="30"></circle><text font-size="14" dy=".35em" text-anchor="middle" stroke-width="1" fill="black" stroke="black" x="30" y="30" style="user-select: none;">0</text></g><g fixed="false" style="cursor: pointer;"><circle stroke-width="2" fill="white" stroke="black" r="18" cx="90" cy="30"></circle><text font-size="14" dy=".35em" text-anchor="middle" stroke-width="1" fill="black" stroke="black" x="90" y="30" style="user-select: none;">1</text></g><g fixed="false" style="cursor: pointer;"><circle stroke-width="2" fill="white" stroke="black" r="18" cx="150" cy="30"></circle><text font-size="14" dy=".35em" text-anchor="middle" stroke-width="1" fill="black" stroke="black" x="150" y="30" style="user-select: none;">2</text></g><g fixed="false" style="cursor: pointer;"><circle stroke-width="2" fill="white" stroke="black" r="18" cx="90" cy="120"></circle><text font-size="14" dy=".35em" text-anchor="middle" stroke-width="1" fill="black" stroke="black" x="90" y="120" style="user-select: none;">3</text></g><g fixed="false" style="cursor: pointer;"><circle stroke-width="2" fill="white" stroke="black" r="18" cx="210" cy="30"></circle><text font-size="14" dy=".35em" text-anchor="middle" stroke-width="1" fill="black" stroke="black" x="210" y="30" style="user-select: none;">4</text></g><g fixed="false" style="cursor: pointer;"><circle stroke-width="2" fill="white" stroke="black" r="18" cx="270" cy="30"></circle><text font-size="14" dy=".35em" text-anchor="middle" stroke-width="1" fill="black" stroke="black" x="270" y="30" style="user-select: none;">5</text></g></g></g></svg></p>
<figcaption style="font-size=8pt">Fonte: <a href="https://csacademy.com/lesson/disjoint_data_sets/">Disjoint-set Data Structures</a></figcaption>
</figure>
<p>Então 2 e 4 se tornam aliados:</p>
<figure>
<p><svg width="230px" height="140px" style="margin: 1.5em auto; display: block; height: 140px; width: 230px;"><g width="230" height="140" style="margin: 1.5em auto; display: block;"><g><g><path d="M 90 120 L 90 30" fill="none" stroke-width="2" stroke="black"></path><path d="M 90 120 L 90 30" opacity="0" fill="none" stroke-width="30" stroke="black"></path><path stroke="black" fill="black" d="M -15 7.5 L 0 0 L -15 -7.5 Z" transform="translate (90 48.099998474121094) rotate(270)"></path></g><g><path d="M 150 120 L 150 30" fill="none" stroke-width="2" stroke="black"></path><path d="M 150 120 L 150 30" opacity="0" fill="none" stroke-width="30" stroke="black"></path><path stroke="black" fill="black" d="M -15 7.5 L 0 0 L -15 -7.5 Z" transform="translate (150 48.099998474121094) rotate(270)"></path></g></g><g><g fixed="false" style="cursor: pointer;"><circle stroke-width="2" fill="white" stroke="black" r="18" cx="30" cy="30"></circle><text font-size="14" dy=".35em" text-anchor="middle" stroke-width="1" fill="black" stroke="black" x="30" y="30" style="user-select: none;">0</text></g><g fixed="false" style="cursor: pointer;"><circle stroke-width="2" fill="white" stroke="black" r="18" cx="90" cy="30"></circle><text font-size="14" dy=".35em" text-anchor="middle" stroke-width="1" fill="black" stroke="black" x="90" y="30" style="user-select: none;">1</text></g><g fixed="false" style="cursor: pointer;"><circle stroke-width="2" fill="white" stroke="black" r="18" cx="150" cy="30"></circle><text font-size="14" dy=".35em" text-anchor="middle" stroke-width="1" fill="black" stroke="black" x="150" y="30" style="user-select: none;">2</text></g><g fixed="false" style="cursor: pointer;"><circle stroke-width="2" fill="white" stroke="black" r="18" cx="90" cy="120"></circle><text font-size="14" dy=".35em" text-anchor="middle" stroke-width="1" fill="black" stroke="black" x="90" y="120" style="user-select: none;">3</text></g><g fixed="false" style="cursor: pointer;"><circle stroke-width="2" fill="white" stroke="black" r="18" cx="150" cy="120"></circle><text font-size="14" dy=".35em" text-anchor="middle" stroke-width="1" fill="black" stroke="black" x="150" y="120" style="user-select: none;">4</text></g><g fixed="false" style="cursor: pointer;"><circle stroke-width="2" fill="white" stroke="black" r="18" cx="210" cy="30"></circle><text font-size="14" dy=".35em" text-anchor="middle" stroke-width="1" fill="black" stroke="black" x="210" y="30" style="user-select: none;">5</text></g></g></g></svg></p>
<figcaption style="font-size=8pt">Fonte: <a href="https://csacademy.com/lesson/disjoint_data_sets/">Disjoint-set Data Structures</a></figcaption>
</figure>
<p>Os amigos 0 e 5 são os próximos. Considere que 5 seja escolhido como representante:</p>
<figure>
<p><svg width="180px" height="140px" style="margin: 1.5em auto; display: block; height: 140px; width: 180px;"><g width="180" height="140" style="margin: 1.5em auto; display: block;"><g><g><path d="M 30 120 L 30 30" fill="none" stroke-width="2" stroke="black"></path><path d="M 30 120 L 30 30" opacity="0" fill="none" stroke-width="30" stroke="black"></path><path stroke="black" fill="black" d="M -15 7.5 L 0 0 L -15 -7.5 Z" transform="translate (30 48.099998474121094) rotate(270)"></path></g><g><path d="M 90 120 L 90 30" fill="none" stroke-width="2" stroke="black"></path><path d="M 90 120 L 90 30" opacity="0" fill="none" stroke-width="30" stroke="black"></path><path stroke="black" fill="black" d="M -15 7.5 L 0 0 L -15 -7.5 Z" transform="translate (90 48.099998474121094) rotate(270)"></path></g><g><path d="M 150 120 L 150 30" fill="none" stroke-width="2" stroke="black"></path><path d="M 150 120 L 150 30" opacity="0" fill="none" stroke-width="30" stroke="black"></path><path stroke="black" fill="black" d="M -15 7.5 L 0 0 L -15 -7.5 Z" transform="translate (150 48.099998474121094) rotate(270)"></path></g></g><g><g fixed="false" style="cursor: pointer;"><circle stroke-width="2" fill="white" stroke="black" r="18" cx="150" cy="120"></circle><text font-size="14" dy=".35em" text-anchor="middle" stroke-width="1" fill="black" stroke="black" x="150" y="120" style="user-select: none;">0</text></g><g fixed="false" style="cursor: pointer;"><circle stroke-width="2" fill="white" stroke="black" r="18" cx="30" cy="30"></circle><text font-size="14" dy=".35em" text-anchor="middle" stroke-width="1" fill="black" stroke="black" x="30" y="30" style="user-select: none;">1</text></g><g fixed="false" style="cursor: pointer;"><circle stroke-width="2" fill="white" stroke="black" r="18" cx="90" cy="30"></circle><text font-size="14" dy=".35em" text-anchor="middle" stroke-width="1" fill="black" stroke="black" x="90" y="30" style="user-select: none;">2</text></g><g fixed="false" style="cursor: pointer;"><circle stroke-width="2" fill="white" stroke="black" r="18" cx="30" cy="120"></circle><text font-size="14" dy=".35em" text-anchor="middle" stroke-width="1" fill="black" stroke="black" x="30" y="120" style="user-select: none;">3</text></g><g fixed="false" style="cursor: pointer;"><circle stroke-width="2" fill="white" stroke="black" r="18" cx="90" cy="120"></circle><text font-size="14" dy=".35em" text-anchor="middle" stroke-width="1" fill="black" stroke="black" x="90" y="120" style="user-select: none;">4</text></g><g fixed="false" style="cursor: pointer;"><circle stroke-width="2" fill="white" stroke="black" r="18" cx="150" cy="30"></circle><text font-size="14" dy=".35em" text-anchor="middle" stroke-width="1" fill="black" stroke="black" x="150" y="30" style="user-select: none;">5</text></g></g></g></svg></p>
<figcaption style="font-size=8pt">Fonte: <a href="https://csacademy.com/lesson/disjoint_data_sets/">Disjoint-set Data Structures</a></figcaption>
</figure>
<p>Finalmente, uma aliança é formada entre 4 e 3. Nesse caso, é preciso pegar a raiz de uma árvore e anexá-la como filho da raiz da outra árvore:</p>
<figure>
<p><svg width="200px" height="230px" style="margin: 1.5em auto; display: block; height: 230px; width: 200px;"><g width="200" height="230" style="margin: 1.5em auto; display: block;"><g><g><path d="M 30 120 L 70 30" fill="none" stroke-width="2" stroke="black"></path><path d="M 30 120 L 70 30" opacity="0" fill="none" stroke-width="30" stroke="black"></path><path stroke="black" fill="black" d="M -15 7.5 L 0 0 L -15 -7.5 Z" transform="translate (62.68950653076172 46.4486083984375) rotate(293.9623763093689)"></path></g><g><path d="M 110 210 L 110 120" fill="none" stroke-width="2" stroke="black"></path><path d="M 110 210 L 110 120" opacity="0" fill="none" stroke-width="30" stroke="black"></path><path stroke="black" fill="black" d="M -15 7.5 L 0 0 L -15 -7.5 Z" transform="translate (110 138.10000610351562) rotate(270)"></path></g><g><path d="M 170 120 L 170 30" fill="none" stroke-width="2" stroke="black"></path><path d="M 170 120 L 170 30" opacity="0" fill="none" stroke-width="30" stroke="black"></path><path stroke="black" fill="black" d="M -15 7.5 L 0 0 L -15 -7.5 Z" transform="translate (170 48.099998474121094) rotate(270)"></path></g><g><path d="M 110 120 L 70 30" fill="none" stroke-width="2" stroke="black"></path><path d="M 110 120 L 70 30" opacity="0" fill="none" stroke-width="30" stroke="black"></path><path stroke="black" fill="black" d="M -15 7.5 L 0 0 L -15 -7.5 Z" transform="translate (77.31049346923828 46.4486083984375) rotate(246.03660971083696)"></path></g></g><g><g fixed="false" style="cursor: pointer;"><circle stroke-width="2" fill="white" stroke="black" r="18" cx="170" cy="120"></circle><text font-size="14" dy=".35em" text-anchor="middle" stroke-width="1" fill="black" stroke="black" x="170" y="120" style="user-select: none;">0</text></g><g fixed="false" style="cursor: pointer;"><circle stroke-width="2" fill="white" stroke="black" r="18" cx="70" cy="30"></circle><text font-size="14" dy=".35em" text-anchor="middle" stroke-width="1" fill="black" stroke="black" x="70" y="30" style="user-select: none;">1</text></g><g fixed="false" style="cursor: pointer;"><circle stroke-width="2" fill="white" stroke="black" r="18" cx="110" cy="120"></circle><text font-size="14" dy=".35em" text-anchor="middle" stroke-width="1" fill="black" stroke="black" x="110" y="120" style="user-select: none;">2</text></g><g fixed="false" style="cursor: pointer;"><circle stroke-width="2" fill="white" stroke="black" r="18" cx="30" cy="120"></circle><text font-size="14" dy=".35em" text-anchor="middle" stroke-width="1" fill="black" stroke="black" x="30" y="120" style="user-select: none;">3</text></g><g fixed="false" style="cursor: pointer;"><circle stroke-width="2" fill="white" stroke="black" r="18" cx="110" cy="210"></circle><text font-size="14" dy=".35em" text-anchor="middle" stroke-width="1" fill="black" stroke="black" x="110" y="210" style="user-select: none;">4</text></g><g fixed="false" style="cursor: pointer;"><circle stroke-width="2" fill="white" stroke="black" r="18" cx="170" cy="30"></circle><text font-size="14" dy=".35em" text-anchor="middle" stroke-width="1" fill="black" stroke="black" x="170" y="30" style="user-select: none;">5</text></g></g></g></svg></p>
<figcaption style="font-size=8pt">Fonte: <a href="https://csacademy.com/lesson/disjoint_data_sets/">Disjoint-set Data Structures</a></figcaption>
</figure>
<h3 id="implementacao_2">Implementação</h3>
<p>A estrutura DSU pode ser implementada usando arrays. Na implementação a seguir, o array <code>pai</code> contém para cada elemento o próximo elemento do encadeamento ou o próprio elemento se ele for um representante. Inicialmente, cada elemento pertence a um conjunto distinto:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1">1</a></span>
<span class="normal"><a href="#__codelineno-23-2">2</a></span>
<span class="normal"><a href="#__codelineno-23-3">3</a></span>
<span class="normal"><a href="#__codelineno-23-4">4</a></span>
<span class="normal"><a href="#__codelineno-23-5">5</a></span>
<span class="normal"><a href="#__codelineno-23-6">6</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="n">vll</span><span class="w"> </span><span class="n">pai</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="kt">void</span><span class="w"> </span><span class="nf">init</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="w">    </span><span class="n">pai</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="w">    </span><span class="n">iota</span><span class="p">(</span><span class="n">pai</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">pai</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// (1)</span>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<ol>
<li><a href="https://en.cppreference.com/w/cpp/algorithm/iota">std:iota</a></li>
</ol>
<p>A função <code>find</code> retorna o representante do elemento <code>x</code>. O representante pode ser encontrado seguindo o encadeamento que começa em <code>x</code>. O código abaixo ilustra essa operação, note que a complexidade da função é <span class="arithmatex">\(O(n)\)</span>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1">1</a></span>
<span class="normal"><a href="#__codelineno-24-2">2</a></span>
<span class="normal"><a href="#__codelineno-24-3">3</a></span>
<span class="normal"><a href="#__codelineno-24-4">4</a></span>
<span class="normal"><a href="#__codelineno-24-5">5</a></span>
<span class="normal"><a href="#__codelineno-24-6">6</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="n">ll</span><span class="w"> </span><span class="nf">find</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">pai</span><span class="p">[</span><span class="n">x</span><span class="p">])</span><span class="w"> </span>
<a id="__codelineno-24-3" name="__codelineno-24-3"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="w">    </span><span class="k">else</span><span class="w"></span>
<a id="__codelineno-24-5" name="__codelineno-24-5"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">find</span><span class="p">(</span><span class="n">pai</span><span class="p">[</span><span class="n">x</span><span class="p">]);</span><span class="w"> </span>
<a id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<!-- Alternativamente, pode-se fazer uma versão iterativa:

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-25-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-25-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-25-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-25-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-25-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-25-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-25-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-25-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-25-10">10</a></span>
<span class="normal"><a href="#__codelineno-25-11">11</a></span>
<span class="normal"><a href="#__codelineno-25-12">12</a></span>
<span class="normal"><a href="#__codelineno-25-13">13</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="n">ll</span><span class="w"> </span><span class="nf">find</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">pai</span><span class="p">[</span><span class="n">x</span><span class="p">])</span><span class="w"> </span>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pai</span><span class="p">[</span><span class="n">x</span><span class="p">];</span><span class="w"></span>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="p">}</span><span class="w"></span>
<a id="__codelineno-25-6" name="__codelineno-25-6"></a><span class="err">```</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"></span>
<a id="__codelineno-25-7" name="__codelineno-25-7"></a>
<a id="__codelineno-25-8" name="__codelineno-25-8"></a><span class="n">A</span><span class="w"> </span><span class="n">função</span><span class="w"> </span><span class="err">`</span><span class="n">sameSet</span><span class="err">`</span><span class="w"> </span><span class="n">verifica</span><span class="w"> </span><span class="n">se</span><span class="w"> </span><span class="n">os</span><span class="w"> </span><span class="n">elementos</span><span class="w"> </span><span class="err">`</span><span class="n">a</span><span class="err">`</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="err">`</span><span class="n">b</span><span class="err">`</span><span class="w"> </span><span class="n">pertencem</span><span class="w"> </span><span class="n">ao</span><span class="w"> </span><span class="n">mesmo</span><span class="w"> </span><span class="n">conjunto</span><span class="p">.</span><span class="w"> </span><span class="n">Isso</span><span class="w"> </span><span class="n">pode</span><span class="w"> </span><span class="n">ser</span><span class="w"> </span><span class="n">feito</span><span class="w"> </span><span class="n">facilmente</span><span class="w"> </span><span class="n">usando</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">função</span><span class="w"> </span><span class="err">`</span><span class="n">find</span><span class="err">`</span><span class="o">:</span><span class="w"></span>
<a id="__codelineno-25-9" name="__codelineno-25-9"></a>
<a id="__codelineno-25-10" name="__codelineno-25-10"></a><span class="err">```</span><span class="n">c</span><span class="o">++</span><span class="w"> </span><span class="n">linenums</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="w"></span>
<a id="__codelineno-25-11" name="__codelineno-25-11"></a><span class="kt">bool</span><span class="w"> </span><span class="n">sameSet</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-25-12" name="__codelineno-25-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">find</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">find</span><span class="p">(</span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-25-13" name="__codelineno-25-13"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
</td></tr></table>

A função `join` une os conjuntos que contêm os elementos `a` e `b`.
<!-- A função primeiro encontra os representantes dos conjuntos e, em seguida, conecta o conjunto menor ao conjunto maior. -->

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1">1</a></span>
<span class="normal"><a href="#__codelineno-26-2">2</a></span>
<span class="normal"><a href="#__codelineno-26-3">3</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">join</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="w">    </span><span class="n">pai</span><span class="p">[</span><span class="n">find</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">find</span><span class="p">(</span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<!-- ```c++ linenums="1"
void join(ll a, ll b) { 
    ll c = find(a); 
    ll d = find(b); 
    if(c != d)
        pai[d] = c; 
}
``` -->

<h4 id="otimizacoes-do-union-find">Otimizações do Union-Find</h4>
<p>A primeira otimização do algoritmo, conhecida como <em><a href="https://cp-algorithms.com/data_structures/disjoint_set_union.html#path-compression-optimization">Path Compression</a></em>, está na busca do representante de um elemento, ou seja, na função <code>find</code>. Observe que se a função <code>find</code> for eficiente, a função <code>join</code> também se torna eficiente.  Note que o que gasta tempo na função são as chamadas recursivas da função que precisam passar por todos os ancestrais de um determinado elemento. Porém, pode-se usar um princípio da Programação Dinâmica: evitar o recálculo! Uma vez que calculado o representante de um elemento <code>x</code> (ou seja, <code>find(x)</code>), pode-se salvá-lo diretamente como seu pai (<code>pai[x]=find(x);</code>). Assim, nas próximas vezes que for calculado o valor de <code>find(x)</code>, a função retornará seu representante rapidamente, pois ele já estará salvo em <code>pai[x]</code>, o que evita a necessidade de percorrer todos os ancestrais que estavam entre <code>x</code> e o representante. Para fazer essa otimização basta que, na hora de  o valor de <code>find(x)</code> for retornado, o mesmo seja salvo em <code>pai[x]</code>. Segue a implementação da função <code>find</code> otimizada:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1">1</a></span>
<span class="normal"><a href="#__codelineno-27-2">2</a></span>
<span class="normal"><a href="#__codelineno-27-3">3</a></span>
<span class="normal"><a href="#__codelineno-27-4">4</a></span>
<span class="normal"><a href="#__codelineno-27-5">5</a></span>
<span class="normal"><a href="#__codelineno-27-6">6</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="n">ll</span><span class="w"> </span><span class="nf">find</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">pai</span><span class="p">[</span><span class="n">x</span><span class="p">])</span><span class="w"> </span>
<a id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="w">    </span><span class="k">else</span><span class="w"></span>
<a id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">pai</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">find</span><span class="p">(</span><span class="n">pai</span><span class="p">[</span><span class="n">x</span><span class="p">]);</span><span class="w"> </span>
<a id="__codelineno-27-6" name="__codelineno-27-6"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<p>Outra otimizaçao, conhecida como <em><a href="https://cp-algorithms.com/data_structures/disjoint_set_union.html#union-by-size-rank">Union by size</a></em>, altera a forma como é feita a união dos conjuntos. Na primeira implementação da função <code>join</code>, o segundo conjunto sempre é anexado ao primeiro, o que pode levar a árvores degeneradas. Nessa otimização, o menor conjunto (menor número de elementos) é unido ao maior conjunto. Segue a implementação da função <code>join</code> otimizada:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-28-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-28-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-28-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-28-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-28-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-28-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-28-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-28-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-28-10">10</a></span>
<span class="normal"><a href="#__codelineno-28-11">11</a></span>
<span class="normal"><a href="#__codelineno-28-12">12</a></span>
<span class="normal"><a href="#__codelineno-28-13">13</a></span>
<span class="normal"><a href="#__codelineno-28-14">14</a></span>
<span class="normal"><a href="#__codelineno-28-15">15</a></span>
<span class="normal"><a href="#__codelineno-28-16">16</a></span>
<span class="normal"><a href="#__codelineno-28-17">17</a></span>
<span class="normal"><a href="#__codelineno-28-18">18</a></span>
<span class="normal"><a href="#__codelineno-28-19">19</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="n">vll</span><span class="w"> </span><span class="n">pai</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="n">vll</span><span class="w"> </span><span class="n">tamanho</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-28-3" name="__codelineno-28-3"></a>
<a id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="kt">void</span><span class="w"> </span><span class="nf">init</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-28-5" name="__codelineno-28-5"></a><span class="w">    </span><span class="n">pai</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-28-6" name="__codelineno-28-6"></a><span class="w">    </span><span class="n">tamanho</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-28-7" name="__codelineno-28-7"></a><span class="w">    </span><span class="n">iota</span><span class="p">(</span><span class="n">pai</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">pai</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-28-8" name="__codelineno-28-8"></a><span class="p">}</span><span class="w"></span>
<a id="__codelineno-28-9" name="__codelineno-28-9"></a>
<a id="__codelineno-28-10" name="__codelineno-28-10"></a><span class="kt">void</span><span class="w"> </span><span class="nf">join</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-28-11" name="__codelineno-28-11"></a><span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">find</span><span class="p">(</span><span class="n">a</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-28-12" name="__codelineno-28-12"></a><span class="w">    </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">find</span><span class="p">(</span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-28-13" name="__codelineno-28-13"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-28-14" name="__codelineno-28-14"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tamanho</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">tamanho</span><span class="p">[</span><span class="n">b</span><span class="p">])</span><span class="w"></span>
<a id="__codelineno-28-15" name="__codelineno-28-15"></a><span class="w">            </span><span class="n">swap</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-28-16" name="__codelineno-28-16"></a><span class="w">        </span><span class="n">pai</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-28-17" name="__codelineno-28-17"></a><span class="w">        </span><span class="n">tamanho</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">tamanho</span><span class="p">[</span><span class="n">b</span><span class="p">];</span><span class="w"></span>
<a id="__codelineno-28-18" name="__codelineno-28-18"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-28-19" name="__codelineno-28-19"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<h3 id="material-complementar_2">Material complementar</h3>
<ul>
<li>⭐️ <a href="https://codeforces.com/edu/course/2/lesson/7">Disjoint Sets Union</a> 🤯</li>
<li>⭐️ <a href="https://cp-algorithms.com/data_structures/disjoint_set_union.html">Disjoint Set Union</a></li>
<li>⭐️ <a href="https://neps.academy/br/course/10/lesson/261">Union-Find (Neps Academy)</a></li>
<li><a href="https://csacademy.com/lesson/disjoint_data_sets/">Disjoint-set Data Structures (CSAcademy)</a></li>
<li><a href="https://www.geeksforgeeks.org/disjoint-set-data-structures/">Disjoint Set Data Structures (GeeksforGeeks)</a></li>
</ul>
<!-- https://noic.com.br/materiais-informatica/curso/data-structures-02/ -->

<!-- <https://github.com/stevenhalim/cpbook-code/blob/master/ch2/ourown/unionfind_ds.cpp> -->

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Voltar para o topo
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Rodapé">
      
        
        <a href="../ed1/" class="md-footer__link md-footer__link--prev" aria-label="Anterior: Estrutura de Dados (Parte 1)" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Anterior
              </span>
              Estrutura de Dados (Parte 1)
            </div>
          </div>
        </a>
      
      
        
        <a href="../buscaexaustiva/" class="md-footer__link md-footer__link--next" aria-label="Próximo: Busca Exaustiva" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Próximo
              </span>
              Busca Exaustiva
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2021 - 2022 Oberlan Romão
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.sections", "toc.integrate", "navigation.top", "content.code.annotate"], "search": "../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copiado para \u00e1rea de Transfer\u00eancia", "clipboard.copy": "Copiar para \u00e1rea de Transfer\u00eancia", "search.config.lang": "pt", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Buscar", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "Nenhum documento encontrado", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Digite para iniciar a busca", "search.result.term.missing": "Perdido", "select.version.title": "Selecione a vers\u00e3o"}}</script>
    
    
      <script src="../assets/javascripts/bundle.6e54b5cd.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>